
# aider chat started at 2025-09-24 16:14:47

> You can skip this check with --no-gitignore  
> Add .aider* to .gitignore (recommended)? (Y)es/(N)o [Yes]: y  
> Added .aider* to .gitignore  
> /root/.pyenv/versions/aider_clean/bin/aider --model gpt-5  
> Aider v0.86.1  
> Main model: gpt-5 with diff edit format  
> Weak model: gpt-5-nano  
> Git repo: .git with 38 files  
> Repo-map: using 4096 tokens, auto refresh  

#### aider --model gpt-4 App.js --message "Create a complete Nonna's Wisdom & Superstition Oracle app with the following features:  
####   
#### 1. MAIN INTERFACE:  
#### - Beautiful Italian-themed UI with red/green/white colors  
#### - Two main buttons: 'Ask Nonna for Wisdom' and 'Check Superstition'  
#### - Text input for user questions  
#### - Animated response area with Italian flag background  
####   
#### 2. NONNA WISDOM FEATURE:  
#### - User types a question or life problem  
#### - App responds with hilariously dramatic Italian grandmother advice  
#### - Include phrases like 'Mamma mia!', 'Madonna santissima!', 'Aye bambino!'  
#### - Responses should be over-the-top dramatic and include Italian cultural references  
#### - Add text-to-speech so Nonna actually talks (use expo-speech)  
####   
#### 3. SUPERSTITION CHECKER:  
#### - Camera integration to take photos (use expo-camera)   
#### - AI analyzes photo and determines what Sicilian superstition applies  
#### - Provides ridiculous ritual to fix the 'problem'  
#### - Examples: spilled salt = throw more salt over shoulder while saying 3 Hail Marys  
####   
#### 4. MONETIZATION:  
#### - Free users get 3 questions per day  
#### - Premium upgrade button for unlimited access  
#### - Show remaining questions counter  
####   
#### 5. ADDITIONAL FEATURES:  
#### - Save favorite Nonna quotes  
#### - Different Nonna personalities (Sicilian Nonna, Roman Nonna, etc.)  
#### - Hand gesture recognition for Italian gestures  
#### - Daily Italian wisdom notifications  
####   
#### 6. STYLING:  
#### - Use beautiful gradients and Italian flag colors  
#### - Add Italian food emojis throughout  
#### - Smooth animations for responses  
#### - Professional but fun design  
####   
#### Make it production-ready for Google Play Store deployment. Include all necessary imports and dependencies."  
> litellm.RateLimitError: RateLimitError: OpenAIException - Your account is not active, please check your billing details on our website.  
> The API provider has rate limited you. Try again later or check your quotas.  
> Retrying in 0.2 seconds...  
> litellm.RateLimitError: RateLimitError: OpenAIException - Your account is not active, please check your billing details on our website.  
> The API provider has rate limited you. Try again later or check your quotas.  
> Retrying in 0.5 seconds...  
> litellm.RateLimitError: RateLimitError: OpenAIException - Your account is not active, please check your billing details on our website.  
> The API provider has rate limited you. Try again later or check your quotas.  
> Retrying in 1.0 seconds...  
>  
>  
> ^C again to exit  
>  
>  
> ^C KeyboardInterrupt  

# aider chat started at 2025-09-24 16:15:35

> /root/.pyenv/versions/aider_clean/bin/aider --model gpt-5  
> Aider v0.86.1  
> Main model: gpt-5 with diff edit format  
> Weak model: gpt-5-nano  
> Git repo: .git with 38 files  
> Repo-map: using 4096 tokens, auto refresh  

#### aider --model gpt-4 App.js --message "Create a complete Nonna's Wisdom & Superstition Oracle app with the following features:  
####   
#### 1. MAIN INTERFACE:  
#### - Beautiful Italian-themed UI with red/green/white colors  
#### - Two main buttons: 'Ask Nonna for Wisdom' and 'Check Superstition'  
#### - Text input for user questions  
#### - Animated response area with Italian flag background  
####   
#### 2. NONNA WISDOM FEATURE:  
#### - User types a question or life problem  
#### - App responds with hilariously dramatic Italian grandmother advice  
#### - Include phrases like 'Mamma mia!', 'Madonna santissima!', 'Aye bambino!'  
#### - Responses should be over-the-top dramatic and include Italian cultural references  
#### - Add text-to-speech so Nonna actually talks (use expo-speech)  
####   
#### 3. SUPERSTITION CHECKER:  
#### - Camera integration to take photos (use expo-camera)   
#### - AI analyzes photo and determines what Sicilian superstition applies  
#### - Provides ridiculous ritual to fix the 'problem'  
#### - Examples: spilled salt = throw more salt over shoulder while saying 3 Hail Marys  
####   
#### 4. MONETIZATION:  
#### - Free users get 3 questions per day  
#### - Premium upgrade button for unlimited access  
#### - Show remaining questions counter  
####   
#### 5. ADDITIONAL FEATURES:  
#### - Save favorite Nonna quotes  
#### - Different Nonna personalities (Sicilian Nonna, Roman Nonna, etc.)  
#### - Hand gesture recognition for Italian gestures  
#### - Daily Italian wisdom notifications  
####   
#### 6. STYLING:  
#### - Use beautiful gradients and Italian flag colors  
#### - Add Italian food emojis throughout  
#### - Smooth animations for responses  
#### - Professional but fun design  
####   
#### Make it production-ready for Google Play Store deployment. Include all necessary imports and dependencies."  

- package.json ‚Äî to add dependencies: expo-speech, expo-camera, expo-notifications, @react-native-async-storage/async-storage, and optionally expo-in-app-purchases for premium.
- app.json ‚Äî to configure permissions and plugins (camera, notifications, in-app purchases) and any Android notification channel settings.
- app/(tabs)/index.tsx ‚Äî to implement the main UI (text input, two main buttons, animated response area, TTS, daily question limits, favorites, personalities, upgrade button).
- app/(tabs)/superstition.tsx ‚Äî new tab screen for the camera-based superstition checker.
- lib/nonna.ts ‚Äî new utility to generate ‚ÄúNonna‚Äù wisdom with personalities and dramatic phrases.
- lib/superstition.ts ‚Äî new utility to ‚Äúanalyze‚Äù photos and return a superstition plus a ritual.
- lib/storage.ts ‚Äî new module for persisting favorites and daily usage counts via AsyncStorage.
- lib/notifications.ts ‚Äî new module to request permissions and schedule daily wisdom notifications.
- lib/premium.ts ‚Äî new module to manage premium gating (free quota vs. unlimited) and integrate IAP state.

Please add these files to the chat so I can proceed with the changes.

> Tokens: 4.5k sent, 246 received. Cost: $0.0080 message, $0.0080 session.  
> app.json  
> Add file to the chat? (Y)es/(N)o/(A)ll/(S)kip all/(D)on't ask again [Yes]: y  
> app/(tabs)/index.tsx  
> Add file to the chat? (Y)es/(N)o/(A)ll/(S)kip all/(D)on't ask again [Yes]: y  
> package.json  
> Add file to the chat? (Y)es/(N)o/(A)ll/(S)kip all/(D)on't ask again [Yes]: y  

app.json
```json
<<<<<<< SEARCH
    "ios": {
      "supportsTablet": true
    },
=======
    "ios": {
      "supportsTablet": true,
      "infoPlist": {
        "NSCameraUsageDescription": "Allow Nonna to see your photo for superstitions and rituals."
      }
    },
>>>>>>> REPLACE
```

app.json
```json
<<<<<<< SEARCH
    "plugins": [
      "expo-router",
=======
    "plugins": [
      "expo-router",
      "expo-notifications",
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import { Image } from 'expo-image';
import { Platform, StyleSheet } from 'react-native';

import { HelloWave } from '@/components/hello-wave';
import ParallaxScrollView from '@/components/parallax-scroll-view';
import { ThemedText } from '@/components/themed-text';
import { ThemedView } from '@/components/themed-view';
import { Link } from 'expo-router';

export default function HomeScreen() {
  return (
    <ParallaxScrollView
      headerBackgroundColor={{ light: '#A1CEDC', dark: '#1D3D47' }}
      headerImage={
        <Image
          source={require('@/assets/images/partial-react-logo.png')}
          style={styles.reactLogo}
        />
      }>
      <ThemedView style={styles.titleContainer}>
        <ThemedText type="title">Welcome!</ThemedText>
        <HelloWave />
      </ThemedView>
      <ThemedView style={styles.stepContainer}>
        <ThemedText type="subtitle">Step 1: Try it</ThemedText>
        <ThemedText>
          Edit <ThemedText type="defaultSemiBold">app/(tabs)/index.tsx</ThemedText> to see changes.
          Press{' '}
          <ThemedText type="defaultSemiBold">
            {Platform.select({
              ios: 'cmd + d',
              android: 'cmd + m',
              web: 'F12',
            })}
          </ThemedText>{' '}
          to open developer tools.
        </ThemedText>
      </ThemedView>
      <ThemedView style={styles.stepContainer}>
        <Link href="/modal">
          <Link.Trigger>
            <ThemedText type="subtitle">Step 2: Explore</ThemedText>
          </Link.Trigger>
          <Link.Preview />
          <Link.Menu>
            <Link.MenuAction title="Action" icon="cube" onPress={() => alert('Action pressed')} />
            <Link.MenuAction
              title="Share"
              icon="square.and.arrow.up"
              onPress={() => alert('Share pressed')}
            />
            <Link.Menu title="More" icon="ellipsis">
              <Link.MenuAction
                title="Delete"
                icon="trash"
                destructive
                onPress={() => alert('Delete pressed')}
              />
            </Link.Menu>
          </Link.Menu>
        </Link>

        <ThemedText>
          {`Tap the Explore tab to learn more about what's included in this starter app.`}
        </ThemedText>
      </ThemedView>
      <ThemedView style={styles.stepContainer}>
        <ThemedText type="subtitle">Step 3: Get a fresh start</ThemedText>
        <ThemedText>
          {`When you're ready, run `}
          <ThemedText type="defaultSemiBold">npm run reset-project</ThemedText> to get a fresh{' '}
          <ThemedText type="defaultSemiBold">app</ThemedText> directory. This will move the current{' '}
          <ThemedText type="defaultSemiBold">app</ThemedText> to{' '}
          <ThemedText type="defaultSemiBold">app-example</ThemedText>.
        </ThemedText>
      </ThemedView>
    </ParallaxScrollView>
  );
}

const styles = StyleSheet.create({
  titleContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    gap: 8,
  },
  stepContainer: {
    gap: 8,
    marginBottom: 8,
  },
  reactLogo: {
    height: 178,
    width: 290,
    bottom: 0,
    left: 0,
    position: 'absolute',
  },
});
=======
import React, { useEffect, useMemo, useRef, useState } from 'react';
import { Platform, StyleSheet, TextInput, View, Pressable, Animated, Alert, ScrollView } from 'react-native';
import { LinearGradient } from 'expo-linear-gradient';
import { Link } from 'expo-router';
import * as Haptics from 'expo-haptics';

import { ThemedText } from '@/components/themed-text';
import { ThemedView } from '@/components/themed-view';

import { generateWisdom, PERSONALITIES, Personality, speakWisdom } from '@/lib/nonna';
import { ensureDailyWisdomScheduled } from '@/lib/notifications';
import { addFavorite, getFavorites, getUsageStatus, tryConsumeQuestion, getPremium, setPremium } from '@/lib/storage';

export default function HomeScreen() {
  const [question, setQuestion] = useState('');
  const [personality, setPersonality] = useState<Personality>('Sicilian Nonna');
  const [response, setResponse] = useState<string>('');
  const [remaining, setRemaining] = useState<number>(3);
  const [isPremium, setIsPremium] = useState<boolean>(false);
  const [favoritesCount, setFavoritesCount] = useState<number>(0);

  const fadeAnim = useRef(new Animated.Value(0)).current;
  const scaleAnim = useRef(new Animated.Value(0.98)).current;

  useEffect(() => {
    const init = async () => {
      const usage = await getUsageStatus();
      setRemaining(usage.remaining);
      setIsPremium(usage.isPremium);

      const favs = await getFavorites();
      setFavoritesCount(favs.length);

      await ensureDailyWisdomScheduled();
    };
    void init();
  }, []);

  const onAskNonna = async () => {
    if (!question.trim()) {
      Alert.alert('Mamma mia!', 'Type a question for Nonna first, amore.');
      return;
    }

    const result = await tryConsumeQuestion();
    if (!result.allowed) {
      setRemaining(result.remaining);
      if (!result.isPremium) {
        Alert.alert(
          'Out of daily questions',
          'Upgrade to Premium for unlimited Nonna advice. Nonna is waiting! üçù',
        );
      }
      return;
    }

    setRemaining(result.remaining);
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);

    const advice = generateWisdom(question.trim(), personality);
    setResponse(advice);
    animateResponse();
    speakWisdom(advice);
  };

  const onSaveFavorite = async () => {
    if (!response) return;
    await addFavorite(response);
    const favs = await getFavorites();
    setFavoritesCount(favs.length);
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
    Alert.alert('Saved ‚ù§Ô∏è', 'Nonna will remember this one.');
  };

  const onUpgrade = async () => {
    await setPremium(true);
    setIsPremium(true);
    setRemaining(Infinity as unknown as number);
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
    Alert.alert('Grazie mille!', 'Premium unlocked. Nonna is yours, senza limiti! üíÉ');
  };

  const animateResponse = () => {
    fadeAnim.setValue(0);
    scaleAnim.setValue(0.98);
    Animated.parallel([
      Animated.timing(fadeAnim, { toValue: 1, duration: 450, useNativeDriver: true }),
      Animated.spring(scaleAnim, { toValue: 1, useNativeDriver: true, friction: 6 }),
    ]).start();
  };

  const remainingLabel = useMemo(() => {
    if (isPremium) return 'Unlimited';
    return `${remaining} left today`;
  }, [isPremium, remaining]);

  const onRecognizeGesture = () => {
    // Fun placeholder for gesture recognition
    const gestures = [
      'ü§å The classic ‚ÄúMa che vuoi?‚Äù pinch detected. Translation: Use more garlic.',
      'ü§ü Cornicello detected! You are protected from the malocchio today.',
      '‚úã Open palm gesture detected. Nonna says: enough drama, eat something.',
      'üëâ Pointing gesture detected. Respect your elders and call your mother!',
    ];
    const pick = gestures[Math.floor(Math.random() * gestures.length)];
    setResponse(`Madonna santissima! Gesture recognized: ${pick}`);
    animateResponse();
  };

  return (
    <ScrollView contentContainerStyle={styles.scroll} keyboardShouldPersistTaps="handled">
      <LinearGradient
        colors={['#CE2B37', '#FFFFFF', '#009246']}
        start={{ x: 0, y: 0 }}
        end={{ x: 1, y: 1 }}
        style={styles.headerGradient}
      >
        <ThemedText type="title" style={styles.title}>Nonna‚Äôs Wisdom & Superstition Oracle üáÆüáπ</ThemedText>
        <ThemedText type="subtitle" style={styles.subtitle}>
          Ask with respect, eat with gusto. üçùüç∑
        </ThemedText>

        <View style={styles.personalityRow}>
          {PERSONALITIES.map((p) => {
            const selected = p === personality;
            return (
              <Pressable
                key={p}
                onPress={() => setPersonality(p)}
                style={[styles.personalityChip, selected && styles.personalityChipSelected]}
              >
                <ThemedText style={[styles.personalityText, selected && styles.personalityTextSelected]}>
                  {p.replace(' Nonna', '')}
                </ThemedText>
              </Pressable>
            );
          })}
        </View>

        <View style={styles.counterRow}>
          <ThemedText type="defaultSemiBold">Questions: {remainingLabel}</ThemedText>
          <ThemedText>Favorites: {favoritesCount}</ThemedText>
        </View>
      </LinearGradient>

      <ThemedView style={styles.content}>
        <TextInput
          value={question}
          onChangeText={setQuestion}
          placeholder="Ask Nonna anything‚Ä¶ (love, food, life, superstition)"
          placeholderTextColor="#666"
          style={styles.input}
          multiline
        />

        <View style={styles.actionsRow}>
          <Pressable
            onPress={onAskNonna}
            style={({ pressed }) => [styles.primaryButton, pressed && styles.buttonPressed]}
          >
            <ThemedText style={styles.primaryButtonText}>Ask Nonna for Wisdom ü§å</ThemedText>
          </Pressable>

          <Link href="/superstition" asChild>
            <Pressable style={({ pressed }) => [styles.secondaryButton, pressed && styles.buttonPressed]}>
              <ThemedText style={styles.secondaryButtonText}>Check Superstition üîÆ</ThemedText>
            </Pressable>
          </Link>
        </View>

        {!isPremium && (
          <Pressable
            onPress={onUpgrade}
            style={({ pressed }) => [styles.upgradeButton, pressed && styles.buttonPressed]}
          >
            <ThemedText style={styles.upgradeButtonText}>Upgrade to Premium ‚Äì Unlimited Advice üíé</ThemedText>
          </Pressable>
        )}

        <Pressable
          onPress={onRecognizeGesture}
          style={({ pressed }) => [styles.gestureButton, pressed && styles.buttonPressed]}
        >
          <ThemedText style={styles.gestureButtonText}>Recognize Hand Gesture (beta) ‚úãü§å</ThemedText>
        </Pressable>

        <LinearGradient
          colors={['rgba(206,43,55,0.15)', 'rgba(255,255,255,0.5)', 'rgba(0,146,70,0.15)']}
          start={{ x: 0, y: 0 }}
          end={{ x: 1, y: 0 }}
          style={styles.responseContainer}
        >
          <Animated.View style={{ opacity: fadeAnim, transform: [{ scale: scaleAnim }] }}>
            {response ? (
              <ThemedText style={styles.responseText}>{response}</ThemedText>
            ) : (
              <ThemedText style={styles.responsePlaceholder}>
                Nonna is listening‚Ä¶ ask her anything. Mamma mia! üçï
              </ThemedText>
            )}
          </Animated.View>
        </LinearGradient>

        {response ? (
          <Pressable
            onPress={onSaveFavorite}
            style={({ pressed }) => [styles.favoriteButton, pressed && styles.buttonPressed]}
          >
            <ThemedText style={styles.favoriteButtonText}>Save to Favorites ‚ù§Ô∏è</ThemedText>
          </Pressable>
        ) : null}
      </ThemedView>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  scroll: {
    paddingBottom: 40,
  },
  headerGradient: {
    paddingTop: 56,
    paddingBottom: 20,
    paddingHorizontal: 16,
  },
  title: {
    textAlign: 'center',
  },
  subtitle: {
    textAlign: 'center',
    marginTop: 6,
  },
  personalityRow: {
    flexDirection: 'row',
    flexWrap: 'wrap',
    gap: 8,
    justifyContent: 'center',
    marginTop: 16,
  },
  personalityChip: {
    paddingVertical: 6,
    paddingHorizontal: 10,
    borderRadius: 16,
    borderWidth: 1,
    borderColor: '#888',
    backgroundColor: 'rgba(255,255,255,0.4)',
  },
  personalityChipSelected: {
    backgroundColor: '#009246',
    borderColor: '#009246',
  },
  personalityText: {
    fontSize: 12,
  },
  personalityTextSelected: {
    color: '#fff',
    fontWeight: '600',
  },
  counterRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginTop: 14,
  },
  content: {
    padding: 16,
    gap: 12,
  },
  input: {
    minHeight: 64,
    borderRadius: 12,
    borderWidth: 1,
    borderColor: '#ccc',
    padding: 12,
    fontSize: 16,
  },
  actionsRow: {
    flexDirection: 'row',
    gap: 12,
  },
  primaryButton: {
    flex: 1,
    backgroundColor: '#CE2B37',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
  },
  primaryButtonText: {
    color: '#fff',
    fontWeight: '700',
  },
  secondaryButton: {
    flex: 1,
    backgroundColor: '#009246',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
  },
  secondaryButtonText: {
    color: '#fff',
    fontWeight: '700',
  },
  buttonPressed: {
    opacity: 0.85,
  },
  upgradeButton: {
    backgroundColor: '#222',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
  },
  upgradeButtonText: {
    color: '#FFD700',
    fontWeight: '700',
  },
  gestureButton: {
    backgroundColor: '#f0f0f0',
    paddingVertical: 10,
    borderRadius: 12,
    alignItems: 'center',
  },
  gestureButtonText: {
    fontWeight: '600',
  },
  responseContainer: {
    minHeight: 140,
    borderRadius: 16,
    padding: 16,
    borderWidth: 1,
    borderColor: '#ddd',
  },
  responseText: {
    fontSize: 16,
    lineHeight: 24,
  },
  responsePlaceholder: {
    fontSize: 16,
    color: '#666',
  },
});
>>>>>>> REPLACE
```

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
=======
import React, { useEffect, useRef, useState } from 'react';
import { StyleSheet, View, Pressable, Alert } from 'react-native';
import { Image } from 'expo-image';
import { CameraView, useCameraPermissions, CameraType } from 'expo-camera';
import * as Haptics from 'expo-haptics';

import { ThemedText } from '@/components/themed-text';
import { ThemedView } from '@/components/themed-view';
import { analyzePhotoAsync, SuperstitionResult } from '@/lib/superstition';

export default function SuperstitionScreen() {
  const [permission, requestPermission] = useCameraPermissions();
  const cameraRef = useRef<CameraView>(null);
  const [photoUri, setPhotoUri] = useState<string | null>(null);
  const [result, setResult] = useState<SuperstitionResult | null>(null);

  useEffect(() => {
    if (!permission) {
      requestPermission();
    }
  }, [permission, requestPermission]);

  if (!permission?.granted) {
    return (
      <ThemedView style={styles.centered}>
        <ThemedText type="title">Camera permission needed</ThemedText>
        <Pressable style={styles.permissionButton} onPress={() => requestPermission()}>
          <ThemedText style={styles.permissionText}>Grant Camera Access</ThemedText>
        </Pressable>
      </ThemedView>
    );
  }

  const onCapture = async () => {
    try {
      const camera = cameraRef.current;
      if (!camera) return;
      // @ts-expect-error -- takePictureAsync is available on ref at runtime
      const photo = await camera.takePictureAsync({ quality: 0.7, skipProcessing: true });
      setPhotoUri(photo?.uri ?? null);
      setResult(null);
      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
      if (photo?.uri) {
        const analysis = await analyzePhotoAsync(photo.uri);
        setResult(analysis);
      }
    } catch (e) {
      Alert.alert('Mamma mia!', 'Nonna cannot see the photo. Try again.');
    }
  };

  return (
    <ThemedView style={styles.container}>
      {!photoUri ? (
        <CameraView
          ref={cameraRef}
          style={styles.camera}
          facing="back"
          enableTorch={false}
          autofocus="on"
        />
      ) : (
        <Image source={{ uri: photoUri }} style={styles.preview} contentFit="cover" />
      )}

      <View style={styles.actions}>
        {!photoUri ? (
          <Pressable style={styles.captureButton} onPress={onCapture}>
            <ThemedText style={styles.captureText}>Capture üîÆ</ThemedText>
          </Pressable>
        ) : (
          <>
            <Pressable style={styles.secondaryButton} onPress={() => setPhotoUri(null)}>
              <ThemedText style={styles.secondaryText}>Retake</ThemedText>
            </Pressable>
            <Pressable style={styles.captureButton} onPress={() => setPhotoUri(null)}>
              <ThemedText style={styles.captureText}>New Photo</ThemedText>
            </Pressable>
          </>
        )}
      </View>

      <View style={styles.result}>
        {result ? (
          <>
            <ThemedText type="title">Superstition Result</ThemedText>
            <ThemedText style={styles.resultText}>
              {result.icon} {result.title}
            </ThemedText>
            <ThemedText style={styles.resultSub}>{result.description}</ThemedText>
            <ThemedText style={styles.ritualTitle}>Ritual</ThemedText>
            <ThemedText style={styles.ritualText}>{result.ritual}</ThemedText>
          </>
        ) : (
          <ThemedText style={styles.hint}>
            Take a photo and let Nonna divine the superstition. Madonna santissima! üì∑
          </ThemedText>
        )}
      </View>
    </ThemedView>
  );
}

const styles = StyleSheet.create({
  container: { flex: 1 },
  centered: { flex: 1, alignItems: 'center', justifyContent: 'center', gap: 16, padding: 16 },
  permissionButton: {
    paddingVertical: 12,
    paddingHorizontal: 16,
    backgroundColor: '#009246',
    borderRadius: 12,
  },
  permissionText: { color: '#fff', fontWeight: '700' },
  camera: { height: 360, width: '100%', borderBottomLeftRadius: 16, borderBottomRightRadius: 16, overflow: 'hidden' },
  preview: { height: 360, width: '100%', borderBottomLeftRadius: 16, borderBottomRightRadius: 16 },
  actions: {
    flexDirection: 'row',
    gap: 12,
    padding: 16,
    alignItems: 'center',
    justifyContent: 'center',
  },
  captureButton: { backgroundColor: '#CE2B37', paddingVertical: 12, paddingHorizontal: 18, borderRadius: 12 },
  captureText: { color: '#fff', fontWeight: '700' },
  secondaryButton: { backgroundColor: '#eee', paddingVertical: 12, paddingHorizontal: 18, borderRadius: 12 },
  secondaryText: { fontWeight: '600' },
  result: { padding: 16, gap: 8 },
  resultText: { fontSize: 18, marginTop: 6, fontWeight: '700' },
  resultSub: { fontSize: 14 },
  ritualTitle: { marginTop: 8, fontWeight: '700' },
  ritualText: { fontSize: 16, lineHeight: 22 },
  hint: { textAlign: 'center', color: '#666', marginTop: 8 },
});
>>>>>>> REPLACE
```

lib/nonna.ts
```typescript
<<<<<<< SEARCH
=======
import * as Speech from 'expo-speech';

export type Personality =
  | 'Sicilian Nonna'
  | 'Roman Nonna'
  | 'Neapolitan Nonna'
  | 'Tuscan Nonna';

export const PERSONALITIES: Personality[] = [
  'Sicilian Nonna',
  'Roman Nonna',
  'Neapolitan Nonna',
  'Tuscan Nonna',
];

const EXCLAMATIONS = [
  'Mamma mia!',
  'Madonna santissima!',
  'Aye bambino!',
  'Uffa!',
  'Per l‚Äôamor di Dio!',
];

const CULTURE_BITS = [
  'You need to eat more, you look skinny like a spaghetti.',
  'Don‚Äôt go outside with wet hair, you‚Äôll catch the malocchio from the wind.',
  'Respect your elders or the sauce will never come out right.',
  'Olive oil fixes everything ‚Äî emotions, joints, frying, marriage.',
  'If the sauce sticks to the spoon, life will stick to you too. Capito?',
];

const FOOD = [
  'Eat some lasagna.',
  'Have a bowl of pasta e fagioli.',
  'A plate of carbonara will solve this.',
  'Some fresh cannoli and you‚Äôll think clearer.',
  'Here, take some leftover parmigiana.',
];

const ACTIONS = [
  'Call your mother.',
  'Drink water and mind your business.',
  'Wear a scarf, even in summer.',
  'Say three Hail Marys, then throw salt over your left shoulder.',
  'Sweep the negative energy out the door, not into the house.',
];

const byPersonality: Record<Personality, string[]> = {
  'Sicilian Nonna': [
    'In Sicily we face problems with a wooden spoon and a stare.',
    'Don‚Äôt test fate, the sea is watching and so is Zia Carmela.',
  ],
  'Roman Nonna': [
    'In Roma, even the statues judge you if you don‚Äôt listen to Nonna.',
    'Take a passeggiata and breathe ‚Äî life is long like the Tiber.',
  ],
  'Neapolitan Nonna': [
    'A Napoli, we sing our problems away and then we eat.',
    'Mind the malocchio ‚Äî wear a cornicello and keep garlic close.',
  ],
  'Tuscan Nonna': [
    'Simple ingredients, simple decisions. Pane, olio, e calma.',
    'If it‚Äôs not worth a good ribollita, it‚Äôs not worth worrying.',
  ],
};

export function generateWisdom(question: string, personality: Personality): string {
  const ex = pick(EXCLAMATIONS);
  const bit = pick(CULTURE_BITS);
  const food = pick(FOOD);
  const act = pick(ACTIONS);
  const per = pick(byPersonality[personality]);
  const closer = [
    'Now sit, eat, and listen.',
    'No more nonsense, capito?',
    'I‚Äôm not yelling, I‚Äôm passionate.',
    'Do as I say or I‚Äôll tell your aunt.',
  ];

  return [
    `${ex} ${capitalize(personality)} has heard your question: ‚Äú${question}‚Äù`,
    per,
    bit,
    `${act} ${food}`,
    pick(closer),
  ].join(' ');
}

export function speakWisdom(text: string) {
  // Slightly slower and lower pitch for ‚ÄúNonna‚Äù tone
  Speech.speak(text, {
    language: 'en-US',
    pitch: 0.9,
    rate: 0.95,
    onDone: () => {},
  });
}

function pick<T>(arr: T[]): T {
  return arr[Math.floor(Math.random() * arr.length)];
}
function capitalize(s: string) {
  return s.charAt(0).toUpperCase() + s.slice(1);
}
>>>>>>> REPLACE
```

lib/storage.ts
```typescript
<<<<<<< SEARCH
=======
import AsyncStorage from '@react-native-async-storage/async-storage';

const KEYS = {
  usage: 'usage:questions',
  premium: 'premium:enabled',
  favorites: 'favorites:quotes',
  notificationsScheduled: 'notifications:daily:scheduled',
};

type UsageState = { date: string; count: number };
const DAILY_LIMIT = 3;

function todayKey() {
  const d = new Date();
  return d.toISOString().slice(0, 10);
}

export async function getUsageStatus(limit: number = DAILY_LIMIT) {
  const premium = await getPremium();
  if (premium) {
    return { isPremium: true, count: 0, remaining: Infinity as unknown as number, limit };
  }
  const raw = await AsyncStorage.getItem(KEYS.usage);
  const today = todayKey();
  let count = 0;
  if (raw) {
    try {
      const parsed: UsageState = JSON.parse(raw);
      if (parsed.date === today) count = parsed.count;
    } catch {}
  }
  const remaining = Math.max(0, limit - count);
  return { isPremium: false, count, remaining, limit };
}

export async function tryConsumeQuestion(limit: number = DAILY_LIMIT) {
  const status = await getUsageStatus(limit);
  if (status.isPremium) {
    return { allowed: true, remaining: Infinity as unknown as number, isPremium: true };
  }
  if (status.remaining <= 0) {
    return { allowed: false, remaining: 0, isPremium: false };
  }
  const today = todayKey();
  const newState: UsageState = { date: today, count: (status.count ?? 0) + 1 };
  await AsyncStorage.setItem(KEYS.usage, JSON.stringify(newState));
  return { allowed: true, remaining: Math.max(0, limit - newState.count), isPremium: false };
}

export async function getPremium() {
  const raw = await AsyncStorage.getItem(KEYS.premium);
  return raw === 'true';
}

export async function setPremium(enabled: boolean) {
  await AsyncStorage.setItem(KEYS.premium, enabled ? 'true' : 'false');
}

export async function getFavorites(): Promise<string[]> {
  const raw = await AsyncStorage.getItem(KEYS.favorites);
  if (!raw) return [];
  try {
    const arr = JSON.parse(raw);
    return Array.isArray(arr) ? arr : [];
  } catch {
    return [];
  }
}

export async function addFavorite(text: string) {
  const current = await getFavorites();
  current.unshift(text);
  const pruned = current.slice(0, 200); // keep last 200
  await AsyncStorage.setItem(KEYS.favorites, JSON.stringify(pruned));
}

export async function removeFavoriteAt(index: number) {
  const current = await getFavorites();
  current.splice(index, 1);
  await AsyncStorage.setItem(KEYS.favorites, JSON.stringify(current));
}

export async function isDailyNotificationScheduled() {
  const flag = await AsyncStorage.getItem(KEYS.notificationsScheduled);
  return flag === 'true';
}

export async function markDailyNotificationScheduled() {
  await AsyncStorage.setItem(KEYS.notificationsScheduled, 'true');
}
>>>>>>> REPLACE
```

lib/notifications.ts
```typescript
<<<<<<< SEARCH
=======
import * as Notifications from 'expo-notifications';
import { isDevice } from 'expo-device';
import { Platform } from 'react-native';
import { isDailyNotificationScheduled, markDailyNotificationScheduled } from './storage';

Notifications.setNotificationHandler({
  handleNotification: async () => ({
    shouldShowAlert: true,
    shouldSetBadge: false,
    shouldPlaySound: false,
  }),
});

async function requestPermissionsAsync() {
  if (!isDevice) return false;
  const settings = await Notifications.getPermissionsAsync();
  if (settings.status !== 'granted') {
    const res = await Notifications.requestPermissionsAsync();
    return res.status === 'granted';
  }
  return true;
}

async function ensureAndroidChannel() {
  if (Platform.OS !== 'android') return;
  await Notifications.setNotificationChannelAsync('daily-wisdom', {
    name: 'Daily Wisdom',
    importance: Notifications.AndroidImportance.DEFAULT,
  });
}

export async function ensureDailyWisdomScheduled() {
  const has = await isDailyNotificationScheduled();
  if (has) return;

  const granted = await requestPermissionsAsync();
  if (!granted) return;

  await ensureAndroidChannel();

  // Schedule every day at 9:00 AM local time
  await Notifications.scheduleNotificationAsync({
    content: {
      title: 'Nonna‚Äôs daily wisdom üáÆüáπ',
      body: 'Come here, bambino! Nonna has fresh advice for you today.',
      sound: null,
    },
    trigger: { hour: 9, minute: 0, repeats: true },
  });

  await markDailyNotificationScheduled();
}
>>>>>>> REPLACE
```

lib/superstition.ts
```typescript
<<<<<<< SEARCH
=======
export type SuperstitionResult = {
  title: string;
  description: string;
  ritual: string;
  icon: string;
};

const SUPERSTITIONS: SuperstitionResult[] = [
  {
    icon: 'üßÇ',
    title: 'Spilled Salt',
    description: 'You angered the kitchen spirits!',
    ritual: 'Throw a pinch of salt over your left shoulder while whispering 3 Hail Marys. Then eat a tomato. Subito.',
  },
  {
    icon: 'üßπ',
    title: 'Broom Touched Your Feet',
    description: 'Oh no, that sweeps your chances of marriage!',
    ritual: 'Spit lightly three times on the broom, step over it backwards, and eat some tiramisu for balance.',
  },
  {
    icon: '‚òÇÔ∏è',
    title: 'Opened Umbrella Indoors',
    description: 'Seven years of drizzle on your soul.',
    ritual: 'Close it, spin it three times clockwise, and say ‚Äúscusami‚Äù to the house. Then light a candle.',
  },
  {
    icon: 'üê±',
    title: 'Black Cat Crossed Your Path',
    description: 'He‚Äôs cute but mischievous.',
    ritual: 'Make the sign of the cross, touch iron, and pet a dog if available. A biscotto also helps.',
  },
  {
    icon: 'üßø',
    title: 'Malocchio (Evil Eye)',
    description: 'Someone is jealous of your sauce.',
    ritual: 'Wear a cornicello, dab olive oil on your forehead, and say Nonna‚Äôs blessing before bed.',
  },
];

export async function analyzePhotoAsync(_uri: string): Promise<SuperstitionResult> {
  // Simulate ‚ÄúAI‚Äù by picking a plausible superstition.
  const pick = SUPERSTITIONS[Math.floor(Math.random() * SUPERSTITIONS.length)];
  // Add slight delay for UX
  await new Promise((r) => setTimeout(r, 600));
  return pick;
}
>>>>>>> REPLACE
```

lib/premium.ts
```typescript
<<<<<<< SEARCH
=======
import { getPremium, setPremium, getUsageStatus, tryConsumeQuestion } from './storage';

export { getPremium, setPremium, getUsageStatus, tryConsumeQuestion };
>>>>>>> REPLACE
```

> Tokens: 6.2k sent, 7.0k received. Cost: $0.08 message, $0.09 session.  
> app/(tabs)/superstition.tsx  
> Create new file? (Y)es/(N)o [Yes]: y  
> lib/nonna.ts  
> Create new file? (Y)es/(N)o [Yes]: y  
> lib/storage.ts  
> Create new file? (Y)es/(N)o [Yes]: y  
> lib/notifications.ts  
> Create new file? (Y)es/(N)o [Yes]: y  
> lib/superstition.ts  
> Create new file? (Y)es/(N)o [Yes]: y  
> lib/premium.ts  
> Create new file? (Y)es/(N)o [Yes]: y  
> Applied edit to lib/premium.ts  
> Applied edit to app/(tabs)/index.tsx  
> Applied edit to lib/notifications.ts  
> Applied edit to app/(tabs)/superstition.tsx  
> Applied edit to lib/storage.ts  
> Applied edit to app.json  
> Applied edit to lib/nonna.ts  
> Applied edit to lib/superstition.ts  
> Commit 0b8152d feat: add Nonna Wisdom & Superstition Oracle with TTS and camera  
> You can use /undo to undo and discard each aider commit.  

#### aider app.json package.json --message "Fix this Expo app completely:  
####   
#### 1. REMOVE expo-notifications from app.json plugins array - it's causing the main error  
#### 2. CREATE a simple working Nonna Wisdom app structure   
#### 3. The app should use the (tabs) structure that's already set up  
#### 4. Make sure all required dependencies are in package.json  
#### 5. Remove any broken or missing plugin references  
#### 6. Keep it simple - no notifications, no complex features yet  
#### 7. Just make the app start without errors  
####   
#### Current error: 'Failed to resolve plugin for module expo-notifications' - remove this completely.  
####   
#### Make this a basic working Expo app with tabs that can actually start and run."  

app.json
```json
<<<<<<< SEARCH
    "plugins": [
      "expo-router",
      "expo-notifications",
      [
        "expo-splash-screen",
=======
    "plugins": [
      "expo-router",
      [
        "expo-splash-screen",
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import { ensureDailyWisdomScheduled } from '@/lib/notifications';
=======
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import { addFavorite, getFavorites, getUsageStatus, tryConsumeQuestion, getPremium, setPremium } from '@/lib/storage';
=======
import { addFavorite, getFavorites, getUsageStatus, tryConsumeQuestion, setPremium } from '@/lib/storage';
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
      await ensureDailyWisdomScheduled();
=======
>>>>>>> REPLACE
```

lib/notifications.ts
```typescript
<<<<<<< SEARCH
import * as Notifications from 'expo-notifications';
import { isDevice } from 'expo-device';
import { Platform } from 'react-native';
import { isDailyNotificationScheduled, markDailyNotificationScheduled } from './storage';

Notifications.setNotificationHandler({
  handleNotification: async () => ({
    shouldShowAlert: true,
    shouldSetBadge: false,
    shouldPlaySound: false,
  }),
});

async function requestPermissionsAsync() {
  if (!isDevice) return false;
  const settings = await Notifications.getPermissionsAsync();
  if (settings.status !== 'granted') {
    const res = await Notifications.requestPermissionsAsync();
    return res.status === 'granted';
  }
  return true;
}

async function ensureAndroidChannel() {
  if (Platform.OS !== 'android') return;
  await Notifications.setNotificationChannelAsync('daily-wisdom', {
    name: 'Daily Wisdom',
    importance: Notifications.AndroidImportance.DEFAULT,
  });
}

export async function ensureDailyWisdomScheduled() {
  const has = await isDailyNotificationScheduled();
  if (has) return;

  const granted = await requestPermissionsAsync();
  if (!granted) return;

  await ensureAndroidChannel();

  // Schedule every day at 9:00 AM local time
  await Notifications.scheduleNotificationAsync({
    content: {
      title: 'Nonna‚Äôs daily wisdom üáÆüáπ',
      body: 'Come here, bambino! Nonna has fresh advice for you today.',
      sound: null,
    },
    trigger: { hour: 9, minute: 0, repeats: true },
  });

  await markDailyNotificationScheduled();
}
=======
export async function ensureDailyWisdomScheduled() {
  // Notifications disabled for the basic working app. No-op.
  return;
}
>>>>>>> REPLACE
```

package.json
```json
<<<<<<< SEARCH
    "expo-web-browser": "~15.0.7",
=======
    "expo-web-browser": "~15.0.7",
    "@react-native-async-storage/async-storage": "^1.23.1",
>>>>>>> REPLACE
```

> Tokens: 19k sent, 637 received. Cost: $0.03 message, $0.12 session.  
> Committing package.json before applying edits.  
> Commit fed5c2c chore: add expo-camera, expo-linear-gradient, expo-speech; reorder deps  
> Applied edit to app/(tabs)/index.tsx  
> Applied edit to lib/notifications.ts  
> Applied edit to package.json  
> Applied edit to app.json  
> Commit e7aed08 fix: remove expo-notifications and simplify to a working tab app  
> You can use /undo to undo and discard each aider commit.  

#### aider app/\(tabs\)/index.tsx --message "Fix all text readability issues. Make sure all text has high contrast against backgrounds. Use dark text on light backgrounds or light text on dark backgrounds. Add proper text shadows or background colors where needed. Make all text clearly readable with good contrast ratios."  

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
        <View style={styles.counterRow}>
          <ThemedText type="defaultSemiBold">Questions: {remainingLabel}</ThemedText>
          <ThemedText>Favorites: {favoritesCount}</ThemedText>
        </View>
=======
        <View style={styles.counterRow}>
          <ThemedText type="defaultSemiBold" style={{ color: '#111' }}>Questions: {remainingLabel}</ThemedText>
          <ThemedText style={{ color: '#111' }}>Favorites: {favoritesCount}</ThemedText>
        </View>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  title: {
    textAlign: 'center',
  },
=======
  title: {
    textAlign: 'center',
    color: '#111',
    backgroundColor: 'rgba(255,255,255,0.85)',
    paddingHorizontal: 12,
    paddingVertical: 6,
    borderRadius: 10,
    overflow: 'hidden',
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  subtitle: {
    textAlign: 'center',
    marginTop: 6,
  },
=======
  subtitle: {
    textAlign: 'center',
    marginTop: 6,
    color: '#111',
    backgroundColor: 'rgba(255,255,255,0.8)',
    paddingHorizontal: 10,
    paddingVertical: 4,
    borderRadius: 8,
    alignSelf: 'center',
    overflow: 'hidden',
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  personalityText: {
    fontSize: 12,
  },
=======
  personalityText: {
    fontSize: 12,
    color: '#111',
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  counterRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginTop: 14,
  },
=======
  counterRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginTop: 14,
    backgroundColor: 'rgba(255,255,255,0.9)',
    paddingVertical: 8,
    paddingHorizontal: 12,
    borderRadius: 10,
    gap: 8,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  primaryButtonText: {
    color: '#fff',
    fontWeight: '700',
  },
=======
  primaryButtonText: {
    color: '#fff',
    fontWeight: '700',
    textShadowColor: 'rgba(0,0,0,0.35)',
    textShadowOffset: { width: 0, height: 1 },
    textShadowRadius: 2,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  secondaryButtonText: {
    color: '#fff',
    fontWeight: '700',
  },
=======
  secondaryButtonText: {
    color: '#fff',
    fontWeight: '700',
    textShadowColor: 'rgba(0,0,0,0.35)',
    textShadowOffset: { width: 0, height: 1 },
    textShadowRadius: 2,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  upgradeButtonText: {
    color: '#FFD700',
    fontWeight: '700',
  },
=======
  upgradeButtonText: {
    color: '#FFD700',
    fontWeight: '700',
    textShadowColor: 'rgba(0,0,0,0.5)',
    textShadowOffset: { width: 0, height: 1 },
    textShadowRadius: 2,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  gestureButtonText: {
    fontWeight: '600',
  },
=======
  gestureButtonText: {
    fontWeight: '600',
    color: '#111',
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  responseText: {
    fontSize: 16,
    lineHeight: 24,
  },
=======
  responseText: {
    fontSize: 16,
    lineHeight: 24,
    color: '#111',
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  responsePlaceholder: {
    fontSize: 16,
    color: '#666',
  },
=======
  responsePlaceholder: {
    fontSize: 16,
    color: '#333',
  },
>>>>>>> REPLACE
```

> Tokens: 19k sent, 979 received. Cost: $0.03 message, $0.15 session.  
> Applied edit to app/(tabs)/index.tsx  
> Commit 5e83cb6 fix: improve text contrast and readability in tabs UI  
> You can use /undo to undo and discard each aider commit.  
>  
>  
> ^C again to exit  

#### # Add object detection  
#### aider app/\(tabs\)/superstition.tsx --message "Create a superstition checker screen with:  
#### 1. Camera view using expo-camera  
#### 2. Take photo button  
#### 3. When photo taken, analyze it and determine what Italian/Sicilian superstition applies  
#### 4. Show dramatic Nonna response about the 'curse' or 'blessing' detected  
#### 5. Give ridiculous Italian ritual to fix it  
#### 6. Examples: spilled food = bad luck, black cat = throw salt, broken mirror = say 7 prayers  
#### 7. Make responses very dramatic and funny"  
>  
>  
> ^C again to exit  

#### aider app/\(tabs\)/index.tsx --message "Add Italian-accented text-to-speech using expo-speech. When Nonna responds:  
#### 1. Set voice to Italian language (it.IT or similar)  
#### 2. Slow down speech rate to sound more dramatic like an Italian grandmother  
#### 3. Add a button to 'Hear Nonna Speak' that reads the response aloud  
#### 4. Use Speech.speak() with Italian voice settings  
#### 5. Make the voice sound as Italian as possible"  

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import * as Haptics from 'expo-haptics';
=======
import * as Haptics from 'expo-haptics';
import * as Speech from 'expo-speech';
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import { generateWisdom, PERSONALITIES, Personality, speakWisdom } from '@/lib/nonna';
=======
import { generateWisdom, PERSONALITIES, Personality } from '@/lib/nonna';
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const [favoritesCount, setFavoritesCount] = useState<number>(0);
=======
  const [favoritesCount, setFavoritesCount] = useState<number>(0);
  const [italianVoice, setItalianVoice] = useState<string | undefined>(undefined);
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  }, []);
=======
  }, []);

  useEffect(() => {
    let mounted = true;
    const loadVoices = async () => {
      try {
        const voices = await Speech.getAvailableVoicesAsync();
        const it =
          voices.find((v) => v.language?.toLowerCase().startsWith('it')) ||
          voices.find((v) => /ital/i.test(v.name || ''));
        if (mounted) setItalianVoice(it?.identifier);
      } catch {
        // ignore voice loading errors
      }
    };
    void loadVoices();
    return () => {
      mounted = false;
      Speech.stop();
    };
  }, []);
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const remainingLabel = useMemo(() => {
=======
  const speakItalian = (text: string) => {
    if (!text) return;
    Speech.stop();
    Speech.speak(text, {
      language: 'it-IT',
      voice: italianVoice,
      pitch: 0.85,
      rate: Platform.select({ ios: 0.5, android: 0.75, default: 0.9 }),
      volume: 1.0,
      onDone: () => {},
    });
  };

  const remainingLabel = useMemo(() => {
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
    speakWisdom(advice);
=======
    speakItalian(advice);
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
        </LinearGradient>

        {response ? (
=======
        </LinearGradient>

        {response ? (
          <Pressable
            onPress={() => speakItalian(response)}
            style={({ pressed }) => [styles.speakButton, pressed && styles.buttonPressed]}
          >
            <ThemedText style={styles.speakButtonText}>Hear Nonna Speak üé§</ThemedText>
          </Pressable>
        ) : null}

        {response ? (
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  gestureButtonText: {
    fontWeight: '600',
    color: '#111',
  },
=======
  gestureButtonText: {
    fontWeight: '600',
    color: '#111',
  },
  speakButton: {
    backgroundColor: '#111',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
  },
  speakButtonText: {
    color: '#fff',
    fontWeight: '700',
    textShadowColor: 'rgba(0,0,0,0.4)',
    textShadowOffset: { width: 0, height: 1 },
    textShadowRadius: 2,
  },
>>>>>>> REPLACE
```

> Tokens: 21k sent, 770 received. Cost: $0.03 message, $0.18 session.  
> Applied edit to app/(tabs)/index.tsx  
> Commit ccf2629 feat: add Italian TTS for Nonna responses with expo-speech  
> You can use /undo to undo and discard each aider commit.  

#### aider app/\(tabs\)/superstition.tsx --message "Create a superstition checker screen with:  
#### 1. Camera view using expo-camera  
#### 2. Take photo button  
#### 3. When photo taken, analyze it and determine what Italian/Sicilian superstition applies  
#### 4. Show dramatic Nonna response about the 'curse' or 'blessing' detected  
#### 5. Give ridiculous Italian ritual to fix it  
#### 6. Examples: spilled food = bad luck, black cat = throw salt, broken mirror = say 7 prayers  
#### 7. Make responses very dramatic and funny"  

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
import { CameraView, useCameraPermissions, CameraType } from 'expo-camera';
=======
import { CameraView, useCameraPermissions } from 'expo-camera';
>>>>>>> REPLACE
```

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
  const [photoUri, setPhotoUri] = useState<string | null>(null);
  const [result, setResult] = useState<SuperstitionResult | null>(null);
=======
  const [photoUri, setPhotoUri] = useState<string | null>(null);
  const [result, setResult] = useState<SuperstitionResult | null>(null);
  const [nonnaResponse, setNonnaResponse] = useState<string>('');
>>>>>>> REPLACE
```

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
      if (photo?.uri) {
        const analysis = await analyzePhotoAsync(photo.uri);
        setResult(analysis);
      }
=======
      if (photo?.uri) {
        const analysis = await analyzePhotoAsync(photo.uri);
        setResult(analysis);
        setNonnaResponse(buildNonnaResponse(analysis));
      }
>>>>>>> REPLACE
```

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
  };
 
  return (
=======
  };

  const buildNonnaResponse = (r: SuperstitionResult): string => {
    const exclamations = [
      'Mamma mia!',
      'Madonna santissima!',
      'Aye bambino!',
      'Per l‚Äôamor di Dio!',
      'Uffa!',
    ];
    const ex = exclamations[Math.floor(Math.random() * exclamations.length)];

    switch (r.title) {
      case 'Spilled Salt':
        return `${ex} You‚Äôve angered the kitchen spirits! Quickly, before the pasta overcooks, make the sign of the cross and don‚Äôt you dare waste another grain. Nonna is watching.`;
      case 'Broom Touched Your Feet':
        return `${ex} Che disastro! That broom just swept away your chances of marriage. But don‚Äôt panic ‚Äî Nonna knows counter-magic.`;
      case 'Opened Umbrella Indoors':
        return `${ex} Who opens an umbrella inside? What are you, trying to invite seven years of drizzle? Close it now and apologize to the house, capito?`;
      case 'Black Cat Crossed Your Path':
        return `${ex} He‚Äôs adorable, s√¨, but mischievous! Touch iron, give that cat a wink, and walk like you own the street. Nonna approves.`;
      case 'Malocchio (Evil Eye)':
        return `${ex} I can feel the malocchio from here ‚Äî someone is jealous of your sauce! Put on the cornicello and glare back with confidence.`;
      case 'Spilled Food':
        return `${ex} You dropped the food? Sacrilegio! That‚Äôs a sign to cook more and share with the neighbors, then cleanse the air with basil and laughter.`;
      case 'Broken Mirror':
        return `${ex} Seven years? Nonna says nonsense ‚Äî but you must show respect. Sweep the shards away from you and don‚Äôt look back.`;
      default:
        return `${ex} Fate is dramatic, but Nonna is more dramatic. Breathe, eat a biscotto, and follow the ritual exactly.`;
    }
  };

  return (
>>>>>>> REPLACE
```

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
            <ThemedText style={styles.ritualText}>{result.ritual}</ThemedText>
=======
            <ThemedText style={styles.ritualText}>{result.ritual}</ThemedText>
            <ThemedText style={styles.nonnaTitle}>Nonna‚Äôs Verdict</ThemedText>
            <ThemedText style={styles.nonnaText}>{nonnaResponse}</ThemedText>
>>>>>>> REPLACE
```

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
  ritualText: { fontSize: 16, lineHeight: 22 },
  hint: { textAlign: 'center', color: '#666', marginTop: 8 },
=======
  ritualText: { fontSize: 16, lineHeight: 22 },
  nonnaTitle: { marginTop: 10, fontWeight: '700', color: '#CE2B37' },
  nonnaText: {
    fontSize: 16,
    lineHeight: 22,
    backgroundColor: 'rgba(255,255,255,0.92)',
    padding: 10,
    borderRadius: 10,
    borderWidth: 1,
    borderColor: '#E5E5E5',
    color: '#111',
  },
  hint: { textAlign: 'center', color: '#666', marginTop: 8 },
>>>>>>> REPLACE
```

lib/superstition.ts
```typescript
<<<<<<< SEARCH
  {
    icon: 'üßø',
    title: 'Malocchio (Evil Eye)',
    description: 'Someone is jealous of your sauce.',
    ritual: 'Wear a cornicello, dab olive oil on your forehead, and say Nonna‚Äôs blessing before bed.',
  },
];
=======
  {
    icon: 'üßø',
    title: 'Malocchio (Evil Eye)',
    description: 'Someone is jealous of your sauce.',
    ritual: 'Wear a cornicello, dab olive oil on your forehead, and say Nonna‚Äôs blessing before bed.',
  },
  {
    icon: 'üçù',
    title: 'Spilled Food',
    description: 'A tragic waste and a sign to be humble.',
    ritual: 'Cook a fresh portion, share a bite with someone, and sprinkle basil while saying ‚Äúpace e amore‚Äù three times.',
  },
  {
    icon: 'ü™û',
    title: 'Broken Mirror',
    description: 'Bad luck tries to sneak in through the shards.',
    ritual: 'Sweep pieces away from you, wrap them in cloth, and say seven prayers before disposing without looking back.',
  },
];
>>>>>>> REPLACE
```

> Tokens: 22k sent, 1.3k received. Cost: $0.04 message, $0.22 session.  
> Applied edit to app/(tabs)/superstition.tsx  
> Applied edit to lib/superstition.ts  
> Commit a45d643 feat: implement superstition checker with Nonna verdict  
> You can use /undo to undo and discard each aider commit.  

#### aider app/\(tabs\)/index.tsx --message "Add working Italian text-to-speech:  
#### 1. Import * as Speech from 'expo-speech'  
#### 2. Create a function that uses Speech.speak() with options: {language: 'it-IT', rate: 0.7, pitch: 0.8}  
#### 3. Add a 'Hear Nonna Speak' button next to each response  
#### 4. Make sure the Italian voice actually works when button is pressed"  

# aider chat started at 2025-09-24 17:42:24

> You can skip this check with --no-gitignore  
> Add .aider* to .gitignore (recommended)? (Y)es/(N)o [Yes]: n  
> /root/.pyenv/versions/aider_clean/bin/aider app.json --message Add proper camera permissions for iOS and Android in the app.json file  
> Using sonnet model with API key from environment.  
> Aider v0.86.1  
> Main model: anthropic/claude-sonnet-4-20250514 with diff edit format, infinite output  
> Weak model: anthropic/claude-3-5-haiku-20241022  
> Git repo: .git with 50 files  
> Repo-map: using 4096 tokens, auto refresh  
> Added app.json to the chat.  

#### Add proper camera permissions for iOS and Android in the app.json file  
>  
>  
> ^C again to exit  

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const speakItalian = (text: string) => {
    if (!text) return;
    Speech.stop();
    Speech.speak(text, {
      language: 'it-IT',
      voice: italianVoice,
      pitch: 0.85,
      rate: Platform.select({ ios: 0.5, android: 0.75, default: 0.9 }),
      volume: 1.0,
      onDone: () => {},
    });
  };
=======
  const speakItalian = (text: string) => {
    if (!text) return;
    Speech.stop();
    Speech.speak(text, {
      language: 'it-IT',
      voice: italianVoice,
      rate: 0.7,
      pitch: 0.8,
      volume: 1.0,
      onDone: () => {},
    });
  };
>>>>>>> REPLACE
```

> Tokens: 24k sent, 196 received. Cost: $0.03 message, $0.26 session.  
> Applied edit to app/(tabs)/index.tsx  
> Commit b94b8a2 fix: set Italian TTS rate to 0.7 and pitch to 0.8  
> You can use /undo to undo and discard each aider commit.  

#### aider app/\(tabs\)/superstition.tsx --message "Fix scrolling issues:  
#### 1. Wrap the entire content in ScrollView component  
#### 2. Import ScrollView from react-native  
#### 3. Make sure all content is scrollable  
#### 4. Add proper padding and margins  
#### 5. Ensure camera view doesn't interfere with scrolling"  

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
import { StyleSheet, View, Pressable, Alert } from 'react-native';
=======
import { StyleSheet, View, Pressable, Alert, ScrollView } from 'react-native';
>>>>>>> REPLACE
```

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
  return (
    <ThemedView style={styles.container}>
=======
  return (
    <ScrollView contentContainerStyle={styles.scroll} keyboardShouldPersistTaps="handled">
      <ThemedView style={styles.container}>
>>>>>>> REPLACE
```

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
    </ThemedView>
  );
}
=======
    </ThemedView>
    </ScrollView>
  );
}
>>>>>>> REPLACE
```

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
const styles = StyleSheet.create({
  container: { flex: 1 },
=======
const styles = StyleSheet.create({
  scroll: { padding: 16, paddingBottom: 32 },
  container: { flex: 1 },
>>>>>>> REPLACE
```

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
  camera: { height: 360, width: '100%', borderBottomLeftRadius: 16, borderBottomRightRadius: 16, overflow: 'hidden' },
=======
  camera: { height: 360, width: '100%', borderBottomLeftRadius: 16, borderBottomRightRadius: 16, overflow: 'hidden', marginBottom: 12 },
>>>>>>> REPLACE
```

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
  preview: { height: 360, width: '100%', borderBottomLeftRadius: 16, borderBottomRightRadius: 16 },
=======
  preview: { height: 360, width: '100%', borderBottomLeftRadius: 16, borderBottomRightRadius: 16, marginBottom: 12 },
>>>>>>> REPLACE
```

> Tokens: 25k sent, 408 received. Cost: $0.03 message, $0.29 session.  
> Applied edit to app/(tabs)/superstition.tsx  
> Commit faa3c0a feat: wrap superstition screen in ScrollView and add padding/margins  
> You can use /undo to undo and discard each aider commit.  

#### # Install NativeBase - professional React Native UI library  
#### npm install native-base react-native-svg react-native-safe-area-context  
####   
#### # Then redesign with beautiful components  
#### aider app/\(tabs\)/index.tsx --message "Completely redesign the UI using NativeBase components:  
#### 1. Import { NativeBaseProvider, Box, VStack, HStack, Button, Input, Text, Center, Card } from 'native-base'  
#### 2. Use proper spacing, shadows, and gradients  
#### 3. Create a clean card-based layout  
#### 4. Use professional color scheme (not harsh red/green)  
#### 5. Add proper typography hierarchy  
#### 6. Make buttons look modern with rounded corners and subtle shadows  
#### 7. Use VStack and HStack for proper spacing  
#### 8. Make it look like a premium mobile app"  

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import React, { useEffect, useMemo, useRef, useState } from 'react';
import { Platform, StyleSheet, TextInput, View, Pressable, Animated, Alert, ScrollView } from 'react-native';
import { LinearGradient } from 'expo-linear-gradient';
import { Link } from 'expo-router';
import * as Haptics from 'expo-haptics';
import * as Speech from 'expo-speech';

import { ThemedText } from '@/components/themed-text';
import { ThemedView } from '@/components/themed-view';

import { generateWisdom, PERSONALITIES, Personality } from '@/lib/nonna';
import { addFavorite, getFavorites, getUsageStatus, tryConsumeQuestion, setPremium } from '@/lib/storage';

export default function HomeScreen() {
  const [question, setQuestion] = useState('');
  const [personality, setPersonality] = useState<Personality>('Sicilian Nonna');
  const [response, setResponse] = useState<string>('');
  const [remaining, setRemaining] = useState<number>(3);
  const [isPremium, setIsPremium] = useState<boolean>(false);
  const [favoritesCount, setFavoritesCount] = useState<number>(0);
  const [italianVoice, setItalianVoice] = useState<string | undefined>(undefined);

  const fadeAnim = useRef(new Animated.Value(0)).current;
  const scaleAnim = useRef(new Animated.Value(0.98)).current;

  useEffect(() => {
    const init = async () => {
      const usage = await getUsageStatus();
      setRemaining(usage.remaining);
      setIsPremium(usage.isPremium);

      const favs = await getFavorites();
      setFavoritesCount(favs.length);

    };
    void init();
  }, []);

  useEffect(() => {
    let mounted = true;
    const loadVoices = async () => {
      try {
        const voices = await Speech.getAvailableVoicesAsync();
        const it =
          voices.find((v) => v.language?.toLowerCase().startsWith('it')) ||
          voices.find((v) => /ital/i.test(v.name || ''));
        if (mounted) setItalianVoice(it?.identifier);
      } catch {
        // ignore voice loading errors
      }
    };
    void loadVoices();
    return () => {
      mounted = false;
      Speech.stop();
    };
  }, []);

  const onAskNonna = async () => {
    if (!question.trim()) {
      Alert.alert('Mamma mia!', 'Type a question for Nonna first, amore.');
      return;
    }

    const result = await tryConsumeQuestion();
    if (!result.allowed) {
      setRemaining(result.remaining);
      if (!result.isPremium) {
        Alert.alert(
          'Out of daily questions',
          'Upgrade to Premium for unlimited Nonna advice. Nonna is waiting! üçù',
        );
      }
      return;
    }

    setRemaining(result.remaining);
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);

    const advice = generateWisdom(question.trim(), personality);
    setResponse(advice);
    animateResponse();
    speakItalian(advice);
  };

  const onSaveFavorite = async () => {
    if (!response) return;
    await addFavorite(response);
    const favs = await getFavorites();
    setFavoritesCount(favs.length);
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
    Alert.alert('Saved ‚ù§Ô∏è', 'Nonna will remember this one.');
  };

  const onUpgrade = async () => {
    await setPremium(true);
    setIsPremium(true);
    setRemaining(Infinity as unknown as number);
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
    Alert.alert('Grazie mille!', 'Premium unlocked. Nonna is yours, senza limiti! üíÉ');
  };

  const animateResponse = () => {
    fadeAnim.setValue(0);
    scaleAnim.setValue(0.98);
    Animated.parallel([
      Animated.timing(fadeAnim, { toValue: 1, duration: 450, useNativeDriver: true }),
      Animated.spring(scaleAnim, { toValue: 1, useNativeDriver: true, friction: 6 }),
    ]).start();
  };

  const speakItalian = (text: string) => {
    if (!text) return;
    Speech.stop();
    Speech.speak(text, {
      language: 'it-IT',
      voice: italianVoice,
      rate: 0.7,
      pitch: 0.8,
      volume: 1.0,
      onDone: () => {},
    });
  };

  const remainingLabel = useMemo(() => {
    if (isPremium) return 'Unlimited';
    return `${remaining} left today`;
  }, [isPremium, remaining]);

  const onRecognizeGesture = () => {
    // Fun placeholder for gesture recognition
    const gestures = [
      'ü§å The classic ‚ÄúMa che vuoi?‚Äù pinch detected. Translation: Use more garlic.',
      'ü§ü Cornicello detected! You are protected from the malocchio today.',
      '‚úã Open palm gesture detected. Nonna says: enough drama, eat something.',
      'üëâ Pointing gesture detected. Respect your elders and call your mother!',
    ];
    const pick = gestures[Math.floor(Math.random() * gestures.length)];
    setResponse(`Madonna santissima! Gesture recognized: ${pick}`);
    animateResponse();
  };

  return (
    <ScrollView contentContainerStyle={styles.scroll} keyboardShouldPersistTaps="handled">
      <LinearGradient
        colors={['#CE2B37', '#FFFFFF', '#009246']}
        start={{ x: 0, y: 0 }}
        end={{ x: 1, y: 1 }}
        style={styles.headerGradient}
      >
        <ThemedText type="title" style={styles.title}>Nonna‚Äôs Wisdom & Superstition Oracle üáÆüáπ</ThemedText>
        <ThemedText type="subtitle" style={styles.subtitle}>
          Ask with respect, eat with gusto. üçùüç∑
        </ThemedText>

        <View style={styles.personalityRow}>
          {PERSONALITIES.map((p) => {
            const selected = p === personality;
            return (
              <Pressable
                key={p}
                onPress={() => setPersonality(p)}
                style={[styles.personalityChip, selected && styles.personalityChipSelected]}
              >
                <ThemedText style={[styles.personalityText, selected && styles.personalityTextSelected]}>
                  {p.replace(' Nonna', '')}
                </ThemedText>
              </Pressable>
            );
          })}
        </View>

        <View style={styles.counterRow}>
          <ThemedText type="defaultSemiBold" style={{ color: '#111' }}>Questions: {remainingLabel}</ThemedText>
          <ThemedText style={{ color: '#111' }}>Favorites: {favoritesCount}</ThemedText>
        </View>
      </LinearGradient>

      <ThemedView style={styles.content}>
        <TextInput
          value={question}
          onChangeText={setQuestion}
          placeholder="Ask Nonna anything‚Ä¶ (love, food, life, superstition)"
          placeholderTextColor="#666"
          style={styles.input}
          multiline
        />

        <View style={styles.actionsRow}>
          <Pressable
            onPress={onAskNonna}
            style={({ pressed }) => [styles.primaryButton, pressed && styles.buttonPressed]}
          >
            <ThemedText style={styles.primaryButtonText}>Ask Nonna for Wisdom ü§å</ThemedText>
          </Pressable>

          <Link href="/superstition" asChild>
            <Pressable style={({ pressed }) => [styles.secondaryButton, pressed && styles.buttonPressed]}>
              <ThemedText style={styles.secondaryButtonText}>Check Superstition üîÆ</ThemedText>
            </Pressable>
          </Link>
        </View>

        {!isPremium && (
          <Pressable
            onPress={onUpgrade}
            style={({ pressed }) => [styles.upgradeButton, pressed && styles.buttonPressed]}
          >
            <ThemedText style={styles.upgradeButtonText}>Upgrade to Premium ‚Äì Unlimited Advice üíé</ThemedText>
          </Pressable>
        )}

        <Pressable
          onPress={onRecognizeGesture}
          style={({ pressed }) => [styles.gestureButton, pressed && styles.buttonPressed]}
        >
          <ThemedText style={styles.gestureButtonText}>Recognize Hand Gesture (beta) ‚úãü§å</ThemedText>
        </Pressable>

        <LinearGradient
          colors={['rgba(206,43,55,0.15)', 'rgba(255,255,255,0.5)', 'rgba(0,146,70,0.15)']}
          start={{ x: 0, y: 0 }}
          end={{ x: 1, y: 0 }}
          style={styles.responseContainer}
        >
          <Animated.View style={{ opacity: fadeAnim, transform: [{ scale: scaleAnim }] }}>
            {response ? (
              <ThemedText style={styles.responseText}>{response}</ThemedText>
            ) : (
              <ThemedText style={styles.responsePlaceholder}>
                Nonna is listening‚Ä¶ ask her anything. Mamma mia! üçï
              </ThemedText>
            )}
          </Animated.View>
        </LinearGradient>

        {response ? (
          <Pressable
            onPress={() => speakItalian(response)}
            style={({ pressed }) => [styles.speakButton, pressed && styles.buttonPressed]}
          >
            <ThemedText style={styles.speakButtonText}>Hear Nonna Speak üé§</ThemedText>
          </Pressable>
        ) : null}

        {response ? (
          <Pressable
            onPress={onSaveFavorite}
            style={({ pressed }) => [styles.favoriteButton, pressed && styles.buttonPressed]}
          >
            <ThemedText style={styles.favoriteButtonText}>Save to Favorites ‚ù§Ô∏è</ThemedText>
          </Pressable>
        ) : null}
      </ThemedView>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  scroll: {
    paddingBottom: 40,
  },
  headerGradient: {
    paddingTop: 56,
    paddingBottom: 20,
    paddingHorizontal: 16,
  },
  title: {
    textAlign: 'center',
    color: '#111',
    backgroundColor: 'rgba(255,255,255,0.85)',
    paddingHorizontal: 12,
    paddingVertical: 6,
    borderRadius: 10,
    overflow: 'hidden',
  },
  subtitle: {
    textAlign: 'center',
    marginTop: 6,
    color: '#111',
    backgroundColor: 'rgba(255,255,255,0.8)',
    paddingHorizontal: 10,
    paddingVertical: 4,
    borderRadius: 8,
    alignSelf: 'center',
    overflow: 'hidden',
  },
  personalityRow: {
    flexDirection: 'row',
    flexWrap: 'wrap',
    gap: 8,
    justifyContent: 'center',
    marginTop: 16,
  },
  personalityChip: {
    paddingVertical: 6,
    paddingHorizontal: 10,
    borderRadius: 16,
    borderWidth: 1,
    borderColor: '#888',
    backgroundColor: 'rgba(255,255,255,0.4)',
  },
  personalityChipSelected: {
    backgroundColor: '#009246',
    borderColor: '#009246',
  },
  personalityText: {
    fontSize: 12,
    color: '#111',
  },
  personalityTextSelected: {
    color: '#fff',
    fontWeight: '600',
  },
  counterRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginTop: 14,
    backgroundColor: 'rgba(255,255,255,0.9)',
    paddingVertical: 8,
    paddingHorizontal: 12,
    borderRadius: 10,
    gap: 8,
  },
  content: {
    padding: 16,
    gap: 12,
  },
  input: {
    minHeight: 64,
    borderRadius: 12,
    borderWidth: 1,
    borderColor: '#ccc',
    padding: 12,
    fontSize: 16,
  },
  actionsRow: {
    flexDirection: 'row',
    gap: 12,
  },
  primaryButton: {
    flex: 1,
    backgroundColor: '#CE2B37',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
  },
  primaryButtonText: {
    color: '#fff',
    fontWeight: '700',
    textShadowColor: 'rgba(0,0,0,0.35)',
    textShadowOffset: { width: 0, height: 1 },
    textShadowRadius: 2,
  },
  secondaryButton: {
    flex: 1,
    backgroundColor: '#009246',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
  },
  secondaryButtonText: {
    color: '#fff',
    fontWeight: '700',
    textShadowColor: 'rgba(0,0,0,0.35)',
    textShadowOffset: { width: 0, height: 1 },
    textShadowRadius: 2,
  },
  buttonPressed: {
    opacity: 0.85,
  },
  upgradeButton: {
    backgroundColor: '#222',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
  },
  upgradeButtonText: {
    color: '#FFD700',
    fontWeight: '700',
    textShadowColor: 'rgba(0,0,0,0.5)',
    textShadowOffset: { width: 0, height: 1 },
    textShadowRadius: 2,
  },
  gestureButton: {
    backgroundColor: '#f0f0f0',
    paddingVertical: 10,
    borderRadius: 12,
    alignItems: 'center',
  },
  gestureButtonText: {
    fontWeight: '600',
    color: '#111',
  },
  speakButton: {
    backgroundColor: '#111',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
  },
  speakButtonText: {
    color: '#fff',
    fontWeight: '700',
    textShadowColor: 'rgba(0,0,0,0.4)',
    textShadowOffset: { width: 0, height: 1 },
    textShadowRadius: 2,
  },
  responseContainer: {
    minHeight: 140,
    borderRadius: 16,
    padding: 16,
    borderWidth: 1,
    borderColor: '#ddd',
  },
  responseText: {
    fontSize: 16,
    lineHeight: 24,
    color: '#111',
  },
  responsePlaceholder: {
    fontSize: 16,
    color: '#333',
  },
});
=======
import React, { useEffect, useMemo, useRef, useState } from 'react';
import { Platform, Animated, Alert } from 'react-native';
import { LinearGradient } from 'expo-linear-gradient';
import { Link } from 'expo-router';
import * as Haptics from 'expo-haptics';
import * as Speech from 'expo-speech';
import {
  NativeBaseProvider,
  Box,
  VStack,
  HStack,
  Button,
  Input,
  Text,
  Center,
  Heading,
  useTheme,
} from 'native-base';

import { generateWisdom, PERSONALITIES, Personality } from '@/lib/nonna';
import { addFavorite, getFavorites, getUsageStatus, tryConsumeQuestion, setPremium } from '@/lib/storage';

function Card(props: React.ComponentProps<typeof Box>) {
  return (
    <Box bg="white" _dark={{ bg: 'coolGray.800' }} rounded="2xl" shadow="3" p="4" {...props} />
  );
}

export default function HomeScreen() {
  const [question, setQuestion] = useState('');
  const [personality, setPersonality] = useState<Personality>('Sicilian Nonna');
  const [response, setResponse] = useState<string>('');
  const [remaining, setRemaining] = useState<number>(3);
  const [isPremium, setIsPremium] = useState<boolean>(false);
  const [favoritesCount, setFavoritesCount] = useState<number>(0);
  const [italianVoice, setItalianVoice] = useState<string | undefined>(undefined);

  const fadeAnim = useRef(new Animated.Value(0)).current;
  const scaleAnim = useRef(new Animated.Value(0.98)).current;

  useEffect(() => {
    const init = async () => {
      const usage = await getUsageStatus();
      setRemaining(usage.remaining);
      setIsPremium(usage.isPremium);

      const favs = await getFavorites();
      setFavoritesCount(favs.length);
    };
    void init();
  }, []);

  useEffect(() => {
    let mounted = true;
    const loadVoices = async () => {
      try {
        const voices = await Speech.getAvailableVoicesAsync();
        const it =
          voices.find((v) => v.language?.toLowerCase().startsWith('it')) ||
          voices.find((v) => /ital/i.test(v.name || ''));
        if (mounted) setItalianVoice(it?.identifier);
      } catch {
        // ignore voice loading errors
      }
    };
    void loadVoices();
    return () => {
      mounted = false;
      Speech.stop();
    };
  }, []);

  const onAskNonna = async () => {
    if (!question.trim()) {
      Alert.alert('Mamma mia!', 'Type a question for Nonna first, amore.');
      return;
    }

    const result = await tryConsumeQuestion();
    if (!result.allowed) {
      setRemaining(result.remaining);
      if (!result.isPremium) {
        Alert.alert(
          'Out of daily questions',
          'Upgrade to Premium for unlimited Nonna advice. Nonna is waiting! üçù'
        );
      }
      return;
    }

    setRemaining(result.remaining);
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);

    const advice = generateWisdom(question.trim(), personality);
    setResponse(advice);
    animateResponse();
    speakItalian(advice);
  };

  const onSaveFavorite = async () => {
    if (!response) return;
    await addFavorite(response);
    const favs = await getFavorites();
    setFavoritesCount(favs.length);
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
    Alert.alert('Saved ‚ù§Ô∏è', 'Nonna will remember this one.');
  };

  const onUpgrade = async () => {
    await setPremium(true);
    setIsPremium(true);
    setRemaining(Infinity as unknown as number);
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
    Alert.alert('Grazie mille!', 'Premium unlocked. Nonna is yours, senza limiti! üíÉ');
  };

  const animateResponse = () => {
    fadeAnim.setValue(0);
    scaleAnim.setValue(0.98);
    Animated.parallel([
      Animated.timing(fadeAnim, { toValue: 1, duration: 450, useNativeDriver: true }),
      Animated.spring(scaleAnim, { toValue: 1, useNativeDriver: true, friction: 6 }),
    ]).start();
  };

  const speakItalian = (text: string) => {
    if (!text) return;
    Speech.stop();
    Speech.speak(text, {
      language: 'it-IT',
      voice: italianVoice,
      rate: 0.7,
      pitch: 0.8,
      volume: 1.0,
      onDone: () => {},
    });
  };

  const remainingLabel = useMemo(() => {
    if (isPremium) return 'Unlimited';
    return `${remaining} left today`;
  }, [isPremium, remaining]);

  const onRecognizeGesture = () => {
    const gestures = [
      'ü§å The classic ‚ÄúMa che vuoi?‚Äù pinch detected. Translation: Use more garlic.',
      'ü§ü Cornicello detected! You are protected from the malocchio today.',
      '‚úã Open palm gesture detected. Nonna says: enough drama, eat something.',
      'üëâ Pointing gesture detected. Respect your elders and call your mother!',
    ];
    const pick = gestures[Math.floor(Math.random() * gestures.length)];
    setResponse(`Madonna santissima! Gesture recognized: ${pick}`);
    animateResponse();
  };

  return (
    <NativeBaseProvider>
      <Box flex={1} bg="muted.50" _dark={{ bg: 'coolGray.900' }}>
        <Box overflow="hidden" roundedBottom="3xl" shadow="6">
          <LinearGradient
            colors={['#6366F1', '#8B5CF6', '#F472B6']}
            start={{ x: 0, y: 0 }}
            end={{ x: 1, y: 1 }}
            style={{ paddingTop: 56, paddingBottom: 20, paddingHorizontal: 16 }}
          >
            <VStack space="2" alignItems="center">
              <Heading size="lg" color="white" textAlign="center">
                Nonna‚Äôs Wisdom & Superstition Oracle üáÆüáπ
              </Heading>
              <Text color="white" opacity={0.9} textAlign="center">
                Ask with respect, eat with gusto. üçùüç∑
              </Text>

              <HStack flexWrap="wrap" space="2" justifyContent="center" mt="3">
                {PERSONALITIES.map((p) => {
                  const selected = p === personality;
                  return (
                    <Button
                      key={p}
                      size="sm"
                      variant={selected ? 'solid' : 'subtle'}
                      colorScheme={selected ? 'purple' : 'coolGray'}
                      rounded="full"
                      onPress={() => setPersonality(p)}
                    >
                      {p.replace(' Nonna', '')}
                    </Button>
                  );
                })}
              </HStack>

              <HStack
                mt="3"
                bg="white"
                _dark={{ bg: 'coolGray.800' }}
                px="4"
                py="2"
                rounded="lg"
                space="4"
                alignItems="center"
              >
                <Text fontWeight="bold">Questions: {remainingLabel}</Text>
                <Text opacity={0.8}>Favorites: {favoritesCount}</Text>
              </HStack>
            </VStack>
          </LinearGradient>
        </Box>

        <VStack space="4" px="4" py="4">
          <Card>
            <VStack space="3">
              <Text fontSize="xs" color="muted.500">
                Ask Nonna anything‚Ä¶ (love, food, life, superstition)
              </Text>
              <Input
                value={question}
                onChangeText={setQuestion}
                placeholder="Type your question"
                variant="filled"
                bg="muted.100"
                _dark={{ bg: 'coolGray.700' }}
                rounded="lg"
                size="md"
              />
              <HStack space="3">
                <Button
                  flex={1}
                  onPress={onAskNonna}
                  colorScheme="purple"
                  rounded="lg"
                  shadow="2"
                >
                  Ask Nonna for Wisdom ü§å
                </Button>
                <Link href="/superstition" asChild>
                  <Button flex={1} colorScheme="emerald" rounded="lg" shadow="2">
                    Check Superstition üîÆ
                  </Button>
                </Link>
              </HStack>

              {!isPremium && (
                <Button
                  onPress={onUpgrade}
                  variant="outline"
                  colorScheme="amber"
                  rounded="lg"
                >
                  Upgrade to Premium ‚Äì Unlimited Advice üíé
                </Button>
              )}

              <Button
                onPress={onRecognizeGesture}
                variant="subtle"
                colorScheme="coolGray"
                rounded="lg"
              >
                Recognize Hand Gesture (beta) ‚úãü§å
              </Button>
            </VStack>
          </Card>

          <Card>
            <VStack space="3">
              <Text fontSize="xs" color="muted.500">
                Nonna‚Äôs Response
              </Text>
              <Box
                rounded="lg"
                borderWidth={1}
                borderColor="muted.200"
                _dark={{ borderColor: 'coolGray.700' }}
                overflow="hidden"
              >
                <LinearGradient
                  colors={['rgba(99,102,241,0.08)', 'rgba(139,92,246,0.08)', 'rgba(244,114,182,0.08)']}
                  start={{ x: 0, y: 0 }}
                  end={{ x: 1, y: 0 }}
                  style={{ padding: 16 }}
                >
                  <Animated.View style={{ opacity: fadeAnim, transform: [{ scale: scaleAnim }] }}>
                    {response ? (
                      <Text fontSize="md">{response}</Text>
                    ) : (
                      <Text color="muted.500">Nonna is listening‚Ä¶ Mamma mia! üçï</Text>
                    )}
                  </Animated.View>
                </LinearGradient>
              </Box>

              {response ? (
                <HStack space="3">
                  <Button
                    flex={1}
                    onPress={() => speakItalian(response)}
                    colorScheme="dark"
                    rounded="lg"
                    variant="solid"
                  >
                    Hear Nonna Speak üé§
                  </Button>
                  <Button
                    flex={1}
                    onPress={onSaveFavorite}
                    colorScheme="rose"
                    rounded="lg"
                    variant="subtle"
                  >
                    Save to Favorites ‚ù§Ô∏è
                  </Button>
                </HStack>
              ) : null}
            </VStack>
          </Card>
        </VStack>
      </Box>
    </NativeBaseProvider>
  );
}
>>>>>>> REPLACE
```

package.json
```json
<<<<<<< SEARCH
    "expo-symbols": "~1.0.7",
    "expo-system-ui": "~6.0.7",
    "expo-web-browser": "~15.0.7",
=======
    "expo-symbols": "~1.0.7",
    "expo-system-ui": "~6.0.7",
    "expo-web-browser": "~15.0.7",
    "native-base": "^3.4.33",
    "react-native-svg": "^15.2.0",
>>>>>>> REPLACE
```

> Tokens: 25k sent, 5.6k received. Cost: $0.09 message, $0.38 session.  
> Applied edit to app/(tabs)/index.tsx  
> Applied edit to package.json  
> Commit d95dec1 feat: migrate UI to NativeBase components and add dependencies  
> You can use /undo to undo and discard each aider commit.  

#### aider app/\(tabs\)/index.tsx --message "Remove the daily question limit completely for testing purposes:  
#### 1. Set dailyQuestions to 999 or remove the limit check entirely  
#### 2. Remove any code that decreases the question counter  
#### 3. Make sure users can ask unlimited questions during development  
#### 4. Comment out or delete the 'Questions: X left today' display  
#### 5. Allow unlimited testing of all features"  

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import React, { useEffect, useMemo, useRef, useState } from 'react';
=======
import React, { useEffect, useRef, useState } from 'react';
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import { addFavorite, getFavorites, getUsageStatus, tryConsumeQuestion, setPremium } from '@/lib/storage';
=======
import { addFavorite, getFavorites, setPremium } from '@/lib/storage';
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const [response, setResponse] = useState<string>('');
  const [remaining, setRemaining] = useState<number>(3);
  const [isPremium, setIsPremium] = useState<boolean>(false);
=======
  const [response, setResponse] = useState<string>('');
  const [isPremium, setIsPremium] = useState<boolean>(false);
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
    const init = async () => {
      const usage = await getUsageStatus();
      setRemaining(usage.remaining);
      setIsPremium(usage.isPremium);

      const favs = await getFavorites();
      setFavoritesCount(favs.length);
    };
=======
    const init = async () => {
      // Unlimited mode: skipping usage limit initialization
      const favs = await getFavorites();
      setFavoritesCount(favs.length);
    };
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
    const result = await tryConsumeQuestion();
    if (!result.allowed) {
      setRemaining(result.remaining);
      if (!result.isPremium) {
        Alert.alert(
          'Out of daily questions',
          'Upgrade to Premium for unlimited Nonna advice. Nonna is waiting! üçù'
        );
      }
      return;
    }

    setRemaining(result.remaining);
=======
    // Unlimited mode: skipping daily limit checks
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const remainingLabel = useMemo(() => {
    if (isPremium) return 'Unlimited';
    return `${remaining} left today`;
  }, [isPremium, remaining]);
=======
  // Unlimited mode: no remaining label
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
              <HStack
                mt="3"
                bg="white"
                _dark={{ bg: 'coolGray.800' }}
                px="4"
                py="2"
                rounded="lg"
                space="4"
                alignItems="center"
              >
                <Text fontWeight="bold">Questions: {remainingLabel}</Text>
                <Text opacity={0.8}>Favorites: {favoritesCount}</Text>
              </HStack>
=======
              <HStack
                mt="3"
                bg="white"
                _dark={{ bg: 'coolGray.800' }}
                px="4"
                py="2"
                rounded="lg"
                space="4"
                alignItems="center"
              >
                <Text fontWeight="bold">Favorites: {favoritesCount}</Text>
              </HStack>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
    setIsPremium(true);
    setRemaining(Infinity as unknown as number);
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
=======
    setIsPremium(true);
    // Unlimited mode: no remaining counter to update
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
>>>>>>> REPLACE
```

> Tokens: 30k sent, 746 received. Cost: $0.05 message, $0.42 session.  
> Applied edit to app/(tabs)/index.tsx  
> Commit a20e9d3 feat: enable unlimited testing by removing daily limit checks and related UI  
> You can use /undo to undo and discard each aider commit.  

#### aider app/\(tabs\)/index.tsx --message "Fix app freezing issues:  
#### 1. Add proper error handling for all async operations  
#### 2. Add loading states so users know something is happening  
#### 3. Prevent multiple rapid button presses that could cause freezing  
#### 4. Add timeout handling for any network requests  
#### 5. Make sure all state updates are properly handled"  

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
} from 'native-base';
=======
} from 'native-base';
import { useToast } from 'native-base';
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const [italianVoice, setItalianVoice] = useState<string | undefined>(undefined);
=======
  const [italianVoice, setItalianVoice] = useState<string | undefined>(undefined);
  const [isAsking, setIsAsking] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [isUpgrading, setIsUpgrading] = useState(false);
  const [isSpeaking, setIsSpeaking] = useState(false);
  const [isLoadingVoices, setIsLoadingVoices] = useState(false);
  const [isGesturing, setIsGesturing] = useState(false);

  const toast = useToast();
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const scaleAnim = useRef(new Animated.Value(0.98)).current;
=======
  const scaleAnim = useRef(new Animated.Value(0.98)).current;

  function withTimeout<T>(promise: Promise<T>, ms: number): Promise<T> {
    return Promise.race<T>([
      promise,
      new Promise<T>((_, reject) => setTimeout(() => reject(new Error('Operation timed out')), ms)),
    ]);
  }
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  useEffect(() => {
    const init = async () => {
      // Unlimited mode: skipping usage limit initialization
      const favs = await getFavorites();
      setFavoritesCount(favs.length);
    };
    void init();
  }, []);
=======
  useEffect(() => {
    let mounted = true;
    const init = async () => {
      try {
        const favs = await withTimeout(getFavorites(), 5000);
        if (mounted) setFavoritesCount(favs.length);
      } catch (err) {
        console.error('Failed to load favorites', err);
        toast.show({ description: 'Error loading favorites. Please try again.' });
      }
    };
    void init();
    return () => {
      mounted = false;
    };
  }, [toast]);
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  useEffect(() => {
    let mounted = true;
    const loadVoices = async () => {
      try {
        const voices = await Speech.getAvailableVoicesAsync();
        const it =
          voices.find((v) => v.language?.toLowerCase().startsWith('it')) ||
          voices.find((v) => /ital/i.test(v.name || ''));
        if (mounted) setItalianVoice(it?.identifier);
      } catch {
        // ignore voice loading errors
      }
    };
    void loadVoices();
    return () => {
      mounted = false;
      Speech.stop();
    };
  }, []);
=======
  useEffect(() => {
    let mounted = true;
    setIsLoadingVoices(true);
    const loadVoices = async () => {
      try {
        const voices = await withTimeout(Speech.getAvailableVoicesAsync(), 5000);
        const it =
          voices.find((v) => v.language?.toLowerCase().startsWith('it')) ||
          voices.find((v) => /ital/i.test(v.name || ''));
        if (mounted) setItalianVoice(it?.identifier);
      } catch (e) {
        console.error('Voice loading failed or timed out', e);
        if (mounted) toast.show({ description: "Italian voice unavailable, using device's default." });
      } finally {
        if (mounted) setIsLoadingVoices(false);
      }
    };
    void loadVoices();
    return () => {
      mounted = false;
      Speech.stop();
    };
  }, [toast]);
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const onAskNonna = async () => {
    if (!question.trim()) {
      Alert.alert('Mamma mia!', 'Type a question for Nonna first, amore.');
      return;
    }

    // Unlimited mode: skipping daily limit checks
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);

    const advice = generateWisdom(question.trim(), personality);
    setResponse(advice);
    animateResponse();
    speakItalian(advice);
  };
=======
  const onAskNonna = async () => {
    if (isAsking) return;
    if (!question.trim()) {
      Alert.alert('Mamma mia!', 'Type a question for Nonna first, amore.');
      return;
    }

    setIsAsking(true);
    try {
      try {
        await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);
      } catch {}

      const advice = generateWisdom(question.trim(), personality);
      setResponse(advice);
      animateResponse();
      speakItalian(advice);
    } catch (err) {
      console.error('onAskNonna error', err);
      toast.show({ description: 'Nonna is tired. Please try again.' });
    } finally {
      setIsAsking(false);
    }
  };
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const onSaveFavorite = async () => {
    if (!response) return;
    await addFavorite(response);
    const favs = await getFavorites();
    setFavoritesCount(favs.length);
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
    Alert.alert('Saved ‚ù§Ô∏è', 'Nonna will remember this one.');
  };
=======
  const onSaveFavorite = async () => {
    if (isSaving || !response) return;
    setIsSaving(true);
    try {
      await withTimeout(addFavorite(response), 5000);
      const favs = await withTimeout(getFavorites(), 5000);
      setFavoritesCount(favs.length);
      try {
        await Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
      } catch {}
      Alert.alert('Saved ‚ù§Ô∏è', 'Nonna will remember this one.');
    } catch (err) {
      console.error('Failed to save favorite', err);
      toast.show({ description: 'Could not save favorite. Please try again.' });
    } finally {
      setIsSaving(false);
    }
  };
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const onUpgrade = async () => {
    await setPremium(true);
    setIsPremium(true);
    // Unlimited mode: no remaining counter to update
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
    Alert.alert('Grazie mille!', 'Premium unlocked. Nonna is yours, senza limiti! üíÉ');
  };
=======
  const onUpgrade = async () => {
    if (isUpgrading) return;
    setIsUpgrading(true);
    try {
      await withTimeout(setPremium(true), 5000);
      setIsPremium(true);
      try {
        await Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
      } catch {}
      Alert.alert('Grazie mille!', 'Premium unlocked. Nonna is yours, senza limiti! üíÉ');
    } catch (err) {
      console.error('Upgrade failed', err);
      toast.show({ description: 'Upgrade failed. Please try again.' });
    } finally {
      setIsUpgrading(false);
    }
  };
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const speakItalian = (text: string) => {
    if (!text) return;
    Speech.stop();
    Speech.speak(text, {
      language: 'it-IT',
      voice: italianVoice,
      rate: 0.7,
      pitch: 0.8,
      volume: 1.0,
      onDone: () => {},
    });
  };
=======
  const speakItalian = (text: string) => {
    if (!text) return;
    try {
      setIsSpeaking(true);
      Speech.stop();
      Speech.speak(text, {
        language: 'it-IT',
        voice: italianVoice,
        rate: 0.7,
        pitch: 0.8,
        volume: 1.0,
        onDone: () => setIsSpeaking(false),
        onStopped: () => setIsSpeaking(false),
      });
    } catch (err) {
      console.error('Speech failed', err);
      setIsSpeaking(false);
      toast.show({ description: 'Unable to speak right now.' });
    }
  };
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const onRecognizeGesture = () => {
    const gestures = [
      'ü§å The classic ‚ÄúMa che vuoi?‚Äù pinch detected. Translation: Use more garlic.',
      'ü§ü Cornicello detected! You are protected from the malocchio today.',
      '‚úã Open palm gesture detected. Nonna says: enough drama, eat something.',
      'üëâ Pointing gesture detected. Respect your elders and call your mother!',
    ];
    const pick = gestures[Math.floor(Math.random() * gestures.length)];
    setResponse(`Madonna santissima! Gesture recognized: ${pick}`);
    animateResponse();
  };
=======
  const onRecognizeGesture = () => {
    if (isGesturing) return;
    setIsGesturing(true);
    try {
      const gestures = [
        'ü§å The classic ‚ÄúMa che vuoi?‚Äù pinch detected. Translation: Use more garlic.',
        'ü§ü Cornicello detected! You are protected from the malocchio today.',
        '‚úã Open palm gesture detected. Nonna says: enough drama, eat something.',
        'üëâ Pointing gesture detected. Respect your elders and call your mother!',
      ];
      const pick = gestures[Math.floor(Math.random() * gestures.length)];
      setResponse(`Madonna santissima! Gesture recognized: ${pick}`);
      animateResponse();
    } catch (err) {
      console.error('Gesture recognition failed', err);
      toast.show({ description: 'Gesture recognition failed. Try again.' });
    } finally {
      setTimeout(() => setIsGesturing(false), 600);
    }
  };
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
              </HStack>
            </VStack>
=======
              </HStack>
              {isLoadingVoices ? (
                <Text mt="2" color="white" opacity={0.8}>
                  Preparing Nonna‚Äôs voice‚Ä¶
                </Text>
              ) : null}
            </VStack>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
                <Button
                  flex={1}
                  onPress={onAskNonna}
                  colorScheme="purple"
                  rounded="lg"
                  shadow="2"
                >
                  Ask Nonna for Wisdom ü§å
                </Button>
=======
                <Button
                  flex={1}
                  onPress={onAskNonna}
                  colorScheme="purple"
                  rounded="lg"
                  shadow="2"
                  isLoading={isAsking}
                  isDisabled={isAsking || !question.trim()}
                >
                  Ask Nonna for Wisdom ü§å
                </Button>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
                <Button
                  onPress={onUpgrade}
                  variant="outline"
                  colorScheme="amber"
                  rounded="lg"
                >
                  Upgrade to Premium ‚Äì Unlimited Advice üíé
                </Button>
=======
                <Button
                  onPress={onUpgrade}
                  variant="outline"
                  colorScheme="amber"
                  rounded="lg"
                  isLoading={isUpgrading}
                  isDisabled={isUpgrading}
                >
                  Upgrade to Premium ‚Äì Unlimited Advice üíé
                </Button>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
              <Button
                onPress={onRecognizeGesture}
                variant="subtle"
                colorScheme="coolGray"
                rounded="lg"
              >
                Recognize Hand Gesture (beta) ‚úãü§å
              </Button>
=======
              <Button
                onPress={onRecognizeGesture}
                variant="subtle"
                colorScheme="coolGray"
                rounded="lg"
                isDisabled={isGesturing}
              >
                Recognize Hand Gesture (beta) ‚úãü§å
              </Button>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
                  <Button
                    flex={1}
                    onPress={() => speakItalian(response)}
                    colorScheme="dark"
                    rounded="lg"
                    variant="solid"
                  >
                    Hear Nonna Speak üé§
                  </Button>
=======
                  <Button
                    flex={1}
                    onPress={() => speakItalian(response)}
                    colorScheme="dark"
                    rounded="lg"
                    variant="solid"
                    isLoading={isSpeaking}
                    isDisabled={isSpeaking || !response}
                  >
                    Hear Nonna Speak üé§
                  </Button>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
                  <Button
                    flex={1}
                    onPress={onSaveFavorite}
                    colorScheme="rose"
                    rounded="lg"
                    variant="subtle"
                  >
                    Save to Favorites ‚ù§Ô∏è
                  </Button>
=======
                  <Button
                    flex={1}
                    onPress={onSaveFavorite}
                    colorScheme="rose"
                    rounded="lg"
                    variant="subtle"
                    isLoading={isSaving}
                    isDisabled={isSaving || !response}
                  >
                    Save to Favorites ‚ù§Ô∏è
                  </Button>
>>>>>>> REPLACE
```

> Tokens: 31k sent, 2.9k received. Cost: $0.07 message, $0.49 session.  
> Applied edit to app/(tabs)/index.tsx  
> Commit eb98928 feat: add timeout wrapper, loading states, and guards  
> You can use /undo to undo and discard each aider commit.  

#### aider app/\(tabs\)/index.tsx app/_layout.tsx --message "Complete professional UI redesign using NativeBase:  
#### 1. Import NativeBaseProvider and wrap the entire app  
#### 2. Replace all existing components with beautiful NativeBase equivalents  
#### 3. Use Cards, proper spacing, professional color scheme  
#### 4. Add subtle shadows and modern styling  
#### 5. Make buttons disabled while processing to prevent freezing  
#### 6. Create a polished, production-ready interface  
#### 7. Remove ugly colors and improve visual hierarchy"  
> app/_layout.tsx  
> Add file to the chat? (Y)es/(N)o/(D)on't ask again [Yes]: y  

app/_layout.tsx
```typescript
<<<<<<< SEARCH
import { DarkTheme, DefaultTheme, ThemeProvider } from '@react-navigation/native';
import { Stack } from 'expo-router';
import { StatusBar } from 'expo-status-bar';
import 'react-native-reanimated';
=======
import { DarkTheme, DefaultTheme, ThemeProvider } from '@react-navigation/native';
import { Stack } from 'expo-router';
import { StatusBar } from 'expo-status-bar';
import 'react-native-reanimated';
import { NativeBaseProvider } from 'native-base';
>>>>>>> REPLACE
```

app/_layout.tsx
```typescript
<<<<<<< SEARCH
  return (
    <ThemeProvider value={colorScheme === 'dark' ? DarkTheme : DefaultTheme}>
      <Stack>
        <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
        <Stack.Screen name="modal" options={{ presentation: 'modal', title: 'Modal' }} />
      </Stack>
      <StatusBar style="auto" />
    </ThemeProvider>
  );
=======
  return (
    <NativeBaseProvider>
      <ThemeProvider value={colorScheme === 'dark' ? DarkTheme : DefaultTheme}>
        <Stack>
          <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
          <Stack.Screen name="modal" options={{ presentation: 'modal', title: 'Modal' }} />
        </Stack>
        <StatusBar style="auto" />
      </ThemeProvider>
    </NativeBaseProvider>
  );
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import {
  NativeBaseProvider,
  Box,
  VStack,
  HStack,
  Button,
  Input,
  Text,
  Center,
  Heading,
  useTheme,
} from 'native-base';
import { useToast } from 'native-base';
=======
import {
  Box,
  VStack,
  HStack,
  Button,
  Input,
  Text,
  Heading,
  useToast,
} from 'native-base';
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
function Card(props: React.ComponentProps<typeof Box>) {
  return (
    <Box bg="white" _dark={{ bg: 'coolGray.800' }} rounded="2xl" shadow="3" p="4" {...props} />
  );
}
=======
function Card(props: React.ComponentProps<typeof Box>) {
  return (
    <Box
      bg="white"
      _dark={{ bg: 'coolGray.800', borderColor: 'coolGray.700' }}
      rounded="2xl"
      shadow="4"
      p="4"
      borderWidth="1"
      borderColor="muted.100"
      {...props}
    />
  );
}
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  return (
    <NativeBaseProvider>
      <Box flex={1} bg="muted.50" _dark={{ bg: 'coolGray.900' }}>
        <Box overflow="hidden" roundedBottom="3xl" shadow="6">
=======
  return (
    <Box flex={1} bg="muted.50" _dark={{ bg: 'coolGray.900' }}>
      <Box overflow="hidden" roundedBottom="3xl" shadow="6">
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
                <Link href="/superstition" asChild>
                  <Button flex={1} colorScheme="emerald" rounded="lg" shadow="2">
                    Check Superstition üîÆ
                  </Button>
                </Link>
=======
                <Link href="/superstition" asChild>
                  <Button flex={1} colorScheme="indigo" rounded="lg" shadow="2">
                    Check Superstition üîÆ
                  </Button>
                </Link>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
      </Box>
    </NativeBaseProvider>
  );
=======
      </Box>
  );
>>>>>>> REPLACE
```

> Tokens: 35k sent, 841 received. Cost: $0.05 message, $0.54 session.  
> Applied edit to app/(tabs)/index.tsx  
> Applied edit to app/_layout.tsx  
> Commit e6829f1 feat: adopt NativeBase UI across app and enhance tab cards  
> You can use /undo to undo and discard each aider commit.  

#### aider app/\(tabs\)/index.tsx app/_layout.tsx --message "Complete professional UI redesign using NativeBase:  
#### 1. Import NativeBaseProvider and wrap the entire app  
#### 2. Replace all existing components with beautiful NativeBase equivalents  
#### 3. Use Cards, proper spacing, professional color scheme  
#### 4. Add subtle shadows and modern styling  
#### 5. Make buttons disabled while processing to prevent freezing  
#### 6. Create a polished, production-ready interface  
#### 7. Remove ugly colors and improve visual hierarchy"  

app/_layout.tsx
```typescript
<<<<<<< SEARCH
import { DarkTheme, DefaultTheme, ThemeProvider } from '@react-navigation/native';
import { Stack } from 'expo-router';
import { StatusBar } from 'expo-status-bar';
import 'react-native-reanimated';
import { NativeBaseProvider } from 'native-base';
=======
import { DarkTheme, DefaultTheme, ThemeProvider } from '@react-navigation/native';
import { Stack } from 'expo-router';
import { StatusBar } from 'expo-status-bar';
import 'react-native-reanimated';
import { NativeBaseProvider, extendTheme } from 'native-base';
import { LinearGradient } from 'expo-linear-gradient';
>>>>>>> REPLACE
```

app/_layout.tsx
```typescript
<<<<<<< SEARCH
export const unstable_settings = {
  anchor: '(tabs)',
};

export default function RootLayout() {
=======
export const unstable_settings = {
  anchor: '(tabs)',
};

const theme = extendTheme({
  colors: {
    primary: {
      50: '#EEF2FF',
      100: '#E0E7FF',
      200: '#C7D2FE',
      300: '#A5B4FC',
      400: '#818CF8',
      500: '#6366F1',
      600: '#5459E6',
      700: '#4546D9',
      800: '#3738CA',
      900: '#2E30B3',
    },
  },
  components: {
    Button: {
      defaultProps: { rounded: 'lg' },
    },
    Input: {
      defaultProps: { rounded: 'lg', variant: 'filled', bg: 'muted.100', _dark: { bg: 'coolGray.700' } },
    },
  },
});

export default function RootLayout() {
>>>>>>> REPLACE
```

app/_layout.tsx
```typescript
<<<<<<< SEARCH
  return (
    <NativeBaseProvider>
      <ThemeProvider value={colorScheme === 'dark' ? DarkTheme : DefaultTheme}>
        <Stack>
          <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
          <Stack.Screen name="modal" options={{ presentation: 'modal', title: 'Modal' }} />
        </Stack>
        <StatusBar style="auto" />
      </ThemeProvider>
    </NativeBaseProvider>
  );
=======
  return (
    <NativeBaseProvider theme={theme} config={{ dependencies: { 'linear-gradient': LinearGradient } }}>
      <ThemeProvider value={colorScheme === 'dark' ? DarkTheme : DefaultTheme}>
        <Stack>
          <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
          <Stack.Screen name="modal" options={{ presentation: 'modal', title: 'Modal' }} />
        </Stack>
        <StatusBar style="auto" />
      </ThemeProvider>
    </NativeBaseProvider>
  );
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import React, { useEffect, useRef, useState } from 'react';
import { Platform, Animated, Alert } from 'react-native';
=======
import React, { useEffect, useRef, useState } from 'react';
import { Animated, Alert } from 'react-native';
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import {
  Box,
  VStack,
  HStack,
  Button,
  Input,
  Text,
  Heading,
  useToast,
} from 'native-base';
=======
import {
  Box,
  ScrollView,
  VStack,
  HStack,
  Button,
  Input,
  Text,
  Heading,
  useToast,
} from 'native-base';
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  return (
    <Box flex={1} bg="muted.50" _dark={{ bg: 'coolGray.900' }}>
      <Box overflow="hidden" roundedBottom="3xl" shadow="6">
=======
  return (
    <Box flex={1} bg="muted.50" _dark={{ bg: 'coolGray.900' }}>
      <ScrollView flex={1} contentContainerStyle={{ paddingBottom: 24 }}>
        <Box overflow="hidden" roundedBottom="3xl" shadow="6">
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
          <LinearGradient
            colors={['#6366F1', '#8B5CF6', '#F472B6']}
            start={{ x: 0, y: 0 }}
            end={{ x: 1, y: 1 }}
            style={{ paddingTop: 56, paddingBottom: 20, paddingHorizontal: 16 }}
          >
            <VStack space="2" alignItems="center">
=======
          <LinearGradient
            colors={['#6366F1', '#8B5CF6', '#F472B6']}
            start={{ x: 0, y: 0 }}
            end={{ x: 1, y: 1 }}
            style={{ paddingTop: 56, paddingBottom: 20, paddingHorizontal: 16 }}
          >
            <Box safeAreaTop />
            <VStack space="2" alignItems="center">
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
                      variant={selected ? 'solid' : 'subtle'}
                      colorScheme={selected ? 'purple' : 'coolGray'}
=======
                      variant={selected ? 'solid' : 'subtle'}
                      colorScheme={selected ? 'primary' : 'coolGray'}
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
                <Button
                  flex={1}
                  onPress={onAskNonna}
                  colorScheme="purple"
                  rounded="lg"
                  shadow="2"
                  isLoading={isAsking}
                  isDisabled={isAsking || !question.trim()}
                >
                  Ask Nonna for Wisdom ü§å
                </Button>
=======
                <Button
                  flex={1}
                  onPress={onAskNonna}
                  colorScheme="primary"
                  rounded="lg"
                  shadow="2"
                  isLoading={isAsking}
                  isDisabled={isAsking || !question.trim()}
                >
                  Ask Nonna for Wisdom ü§å
                </Button>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
                <Link href="/superstition" asChild>
                  <Button flex={1} colorScheme="indigo" rounded="lg" shadow="2">
                    Check Superstition üîÆ
                  </Button>
                </Link>
=======
                <Link href="/superstition" asChild>
                  <Button flex={1} colorScheme="primary" rounded="lg" shadow="2" variant="outline">
                    Check Superstition üîÆ
                  </Button>
                </Link>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
                  <Button
                    flex={1}
                    onPress={() => speakItalian(response)}
                    colorScheme="dark"
                    rounded="lg"
                    variant="solid"
                    isLoading={isSpeaking}
                    isDisabled={isSpeaking || !response}
                  >
                    Hear Nonna Speak üé§
                  </Button>
=======
                  <Button
                    flex={1}
                    onPress={() => speakItalian(response)}
                    colorScheme="primary"
                    rounded="lg"
                    variant="solid"
                    isLoading={isSpeaking}
                    isDisabled={isSpeaking || !response}
                  >
                    Hear Nonna Speak üé§
                  </Button>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
          </Card>
        </VStack>
      </Box>
  );
=======
          </Card>
        </VStack>
      </ScrollView>
    </Box>
  );
>>>>>>> REPLACE
```

> Tokens: 36k sent, 1.6k received. Cost: $0.06 message, $0.61 session.  
> Applied edit to app/(tabs)/index.tsx  
> Applied edit to app/_layout.tsx  
> Commit 95d679c feat: migrate UI to NativeBase with theme, gradient header, and scroll  
> You can use /undo to undo and discard each aider commit.  

#### aider package.json --message "Remove native-base, react-native-svg, and react-native-safe-area-context from dependencies. Keep only essential Expo dependencies. Clean up package.json to have minimal working dependencies."  
> Repo-map can't include /root/NonnaWisdomApp/package-lock.json  
> Has it been deleted from the file system but not from git?  

package.json
```json
<<<<<<< SEARCH
    "expo-web-browser": "~15.0.7",
    "native-base": "^3.4.33",
    "react-native-svg": "^15.2.0",
    "react": "19.1.0",
=======
    "expo-web-browser": "~15.0.7",
    "react": "19.1.0",
>>>>>>> REPLACE
```

package.json
```json
<<<<<<< SEARCH
    "react-native-reanimated": "~4.1.0",
    "react-native-safe-area-context": "~5.6.0",
    "react-native-screens": "~4.16.0",
=======
    "react-native-reanimated": "~4.1.0",
    "react-native-screens": "~4.16.0",
>>>>>>> REPLACE
```

> Tokens: 38k sent, 173 received. Cost: $0.05 message, $0.65 session.  
> Applied edit to package.json  
> Commit b8aa51c chore: drop native-base, react-native-svg, safe-area-context  
> You can use /undo to undo and discard each aider commit.  

#### aider app/\(tabs\)/index.tsx --message "Create a professional UI using ONLY React Native built-in components:  
#### 1. Remove ALL external library imports  
#### 2. Use only: View, Text, TextInput, TouchableOpacity, ScrollView, StyleSheet  
#### 3. Create professional styling with shadows, gradients, proper spacing  
#### 4. Remove daily question limit - make it unlimited  
#### 5. Add loading states to prevent freezing  
#### 6. Use clean color scheme: #f8f9fa backgrounds, #495057 text, #007bff buttons  
#### 7. Add borderRadius, elevation/shadowOffset for modern look  
#### 8. Make it look professional without any external dependencies"  

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import React, { useEffect, useRef, useState } from 'react';
import { Animated, Alert } from 'react-native';
import { LinearGradient } from 'expo-linear-gradient';
import { Link } from 'expo-router';
import * as Haptics from 'expo-haptics';
import * as Speech from 'expo-speech';
import {
  Box,
  ScrollView,
  VStack,
  HStack,
  Button,
  Input,
  Text,
  Heading,
  useToast,
} from 'native-base';

import { generateWisdom, PERSONALITIES, Personality } from '@/lib/nonna';
import { addFavorite, getFavorites, setPremium } from '@/lib/storage';

function Card(props: React.ComponentProps<typeof Box>) {
  return (
    <Box
      bg="white"
      _dark={{ bg: 'coolGray.800', borderColor: 'coolGray.700' }}
      rounded="2xl"
      shadow="4"
      p="4"
      borderWidth="1"
      borderColor="muted.100"
      {...props}
    />
  );
}

export default function HomeScreen() {
  const [question, setQuestion] = useState('');
  const [personality, setPersonality] = useState<Personality>('Sicilian Nonna');
  const [response, setResponse] = useState<string>('');
  const [isPremium, setIsPremium] = useState<boolean>(false);
  const [favoritesCount, setFavoritesCount] = useState<number>(0);
  const [italianVoice, setItalianVoice] = useState<string | undefined>(undefined);
  const [isAsking, setIsAsking] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [isUpgrading, setIsUpgrading] = useState(false);
  const [isSpeaking, setIsSpeaking] = useState(false);
  const [isLoadingVoices, setIsLoadingVoices] = useState(false);
  const [isGesturing, setIsGesturing] = useState(false);

  const toast = useToast();

  const fadeAnim = useRef(new Animated.Value(0)).current;
  const scaleAnim = useRef(new Animated.Value(0.98)).current;

  function withTimeout<T>(promise: Promise<T>, ms: number): Promise<T> {
    return Promise.race<T>([
      promise,
      new Promise<T>((_, reject) => setTimeout(() => reject(new Error('Operation timed out')), ms)),
    ]);
  }

  useEffect(() => {
    let mounted = true;
    const init = async () => {
      try {
        const favs = await withTimeout(getFavorites(), 5000);
        if (mounted) setFavoritesCount(favs.length);
      } catch (err) {
        console.error('Failed to load favorites', err);
        toast.show({ description: 'Error loading favorites. Please try again.' });
      }
    };
    void init();
    return () => {
      mounted = false;
    };
  }, [toast]);

  useEffect(() => {
    let mounted = true;
    setIsLoadingVoices(true);
    const loadVoices = async () => {
      try {
        const voices = await withTimeout(Speech.getAvailableVoicesAsync(), 5000);
        const it =
          voices.find((v) => v.language?.toLowerCase().startsWith('it')) ||
          voices.find((v) => /ital/i.test(v.name || ''));
        if (mounted) setItalianVoice(it?.identifier);
      } catch (e) {
        console.error('Voice loading failed or timed out', e);
        if (mounted) toast.show({ description: "Italian voice unavailable, using device's default." });
      } finally {
        if (mounted) setIsLoadingVoices(false);
      }
    };
    void loadVoices();
    return () => {
      mounted = false;
      Speech.stop();
    };
  }, [toast]);

  const onAskNonna = async () => {
    if (isAsking) return;
    if (!question.trim()) {
      Alert.alert('Mamma mia!', 'Type a question for Nonna first, amore.');
      return;
    }

    setIsAsking(true);
    try {
      try {
        await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);
      } catch {}

      const advice = generateWisdom(question.trim(), personality);
      setResponse(advice);
      animateResponse();
      speakItalian(advice);
    } catch (err) {
      console.error('onAskNonna error', err);
      toast.show({ description: 'Nonna is tired. Please try again.' });
    } finally {
      setIsAsking(false);
    }
  };

  const onSaveFavorite = async () => {
    if (isSaving || !response) return;
    setIsSaving(true);
    try {
      await withTimeout(addFavorite(response), 5000);
      const favs = await withTimeout(getFavorites(), 5000);
      setFavoritesCount(favs.length);
      try {
        await Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
      } catch {}
      Alert.alert('Saved ‚ù§Ô∏è', 'Nonna will remember this one.');
    } catch (err) {
      console.error('Failed to save favorite', err);
      toast.show({ description: 'Could not save favorite. Please try again.' });
    } finally {
      setIsSaving(false);
    }
  };

  const onUpgrade = async () => {
    if (isUpgrading) return;
    setIsUpgrading(true);
    try {
      await withTimeout(setPremium(true), 5000);
      setIsPremium(true);
      try {
        await Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
      } catch {}
      Alert.alert('Grazie mille!', 'Premium unlocked. Nonna is yours, senza limiti! üíÉ');
    } catch (err) {
      console.error('Upgrade failed', err);
      toast.show({ description: 'Upgrade failed. Please try again.' });
    } finally {
      setIsUpgrading(false);
    }
  };

  const animateResponse = () => {
    fadeAnim.setValue(0);
    scaleAnim.setValue(0.98);
    Animated.parallel([
      Animated.timing(fadeAnim, { toValue: 1, duration: 450, useNativeDriver: true }),
      Animated.spring(scaleAnim, { toValue: 1, useNativeDriver: true, friction: 6 }),
    ]).start();
  };

  const speakItalian = (text: string) => {
    if (!text) return;
    try {
      setIsSpeaking(true);
      Speech.stop();
      Speech.speak(text, {
        language: 'it-IT',
        voice: italianVoice,
        rate: 0.7,
        pitch: 0.8,
        volume: 1.0,
        onDone: () => setIsSpeaking(false),
        onStopped: () => setIsSpeaking(false),
      });
    } catch (err) {
      console.error('Speech failed', err);
      setIsSpeaking(false);
      toast.show({ description: 'Unable to speak right now.' });
    }
  };

  // Unlimited mode: no remaining label

  const onRecognizeGesture = () => {
    if (isGesturing) return;
    setIsGesturing(true);
    try {
      const gestures = [
        'ü§å The classic ‚ÄúMa che vuoi?‚Äù pinch detected. Translation: Use more garlic.',
        'ü§ü Cornicello detected! You are protected from the malocchio today.',
        '‚úã Open palm gesture detected. Nonna says: enough drama, eat something.',
        'üëâ Pointing gesture detected. Respect your elders and call your mother!',
      ];
      const pick = gestures[Math.floor(Math.random() * gestures.length)];
      setResponse(`Madonna santissima! Gesture recognized: ${pick}`);
      animateResponse();
    } catch (err) {
      console.error('Gesture recognition failed', err);
      toast.show({ description: 'Gesture recognition failed. Try again.' });
    } finally {
      setTimeout(() => setIsGesturing(false), 600);
    }
  };

  return (
    <Box flex={1} bg="muted.50" _dark={{ bg: 'coolGray.900' }}>
      <ScrollView flex={1} contentContainerStyle={{ paddingBottom: 24 }}>
        <Box overflow="hidden" roundedBottom="3xl" shadow="6">
          <LinearGradient
            colors={['#6366F1', '#8B5CF6', '#F472B6']}
            start={{ x: 0, y: 0 }}
            end={{ x: 1, y: 1 }}
            style={{ paddingTop: 56, paddingBottom: 20, paddingHorizontal: 16 }}
          >
            <Box safeAreaTop />
            <VStack space="2" alignItems="center">
              <Heading size="lg" color="white" textAlign="center">
                Nonna‚Äôs Wisdom & Superstition Oracle üáÆüáπ
              </Heading>
              <Text color="white" opacity={0.9} textAlign="center">
                Ask with respect, eat with gusto. üçùüç∑
              </Text>

              <HStack flexWrap="wrap" space="2" justifyContent="center" mt="3">
                {PERSONALITIES.map((p) => {
                  const selected = p === personality;
                  return (
                    <Button
                      key={p}
                      size="sm"
                      variant={selected ? 'solid' : 'subtle'}
                      colorScheme={selected ? 'primary' : 'coolGray'}
                      rounded="full"
                      onPress={() => setPersonality(p)}
                    >
                      {p.replace(' Nonna', '')}
                    </Button>
                  );
                })}
              </HStack>

              <HStack
                mt="3"
                bg="white"
                _dark={{ bg: 'coolGray.800' }}
                px="4"
                py="2"
                rounded="lg"
                space="4"
                alignItems="center"
              >
                <Text fontWeight="bold">Favorites: {favoritesCount}</Text>
              </HStack>
              {isLoadingVoices ? (
                <Text mt="2" color="white" opacity={0.8}>
                  Preparing Nonna‚Äôs voice‚Ä¶
                </Text>
              ) : null}
            </VStack>
          </LinearGradient>
        </Box>

        <VStack space="4" px="4" py="4">
          <Card>
            <VStack space="3">
              <Text fontSize="xs" color="muted.500">
                Ask Nonna anything‚Ä¶ (love, food, life, superstition)
              </Text>
              <Input
                value={question}
                onChangeText={setQuestion}
                placeholder="Type your question"
                variant="filled"
                bg="muted.100"
                _dark={{ bg: 'coolGray.700' }}
                rounded="lg"
                size="md"
              />
              <HStack space="3">
                <Button
                  flex={1}
                  onPress={onAskNonna}
                  colorScheme="primary"
                  rounded="lg"
                  shadow="2"
                  isLoading={isAsking}
                  isDisabled={isAsking || !question.trim()}
                >
                  Ask Nonna for Wisdom ü§å
                </Button>
                <Link href="/superstition" asChild>
                  <Button flex={1} colorScheme="primary" rounded="lg" shadow="2" variant="outline">
                    Check Superstition üîÆ
                  </Button>
                </Link>
              </HStack>

              {!isPremium && (
                <Button
                  onPress={onUpgrade}
                  variant="outline"
                  colorScheme="amber"
                  rounded="lg"
                  isLoading={isUpgrading}
                  isDisabled={isUpgrading}
                >
                  Upgrade to Premium ‚Äì Unlimited Advice üíé
                </Button>
              )}

              <Button
                onPress={onRecognizeGesture}
                variant="subtle"
                colorScheme="coolGray"
                rounded="lg"
                isDisabled={isGesturing}
              >
                Recognize Hand Gesture (beta) ‚úãü§å
              </Button>
            </VStack>
          </Card>

          <Card>
            <VStack space="3">
              <Text fontSize="xs" color="muted.500">
                Nonna‚Äôs Response
              </Text>
              <Box
                rounded="lg"
                borderWidth={1}
                borderColor="muted.200"
                _dark={{ borderColor: 'coolGray.700' }}
                overflow="hidden"
              >
                <LinearGradient
                  colors={['rgba(99,102,241,0.08)', 'rgba(139,92,246,0.08)', 'rgba(244,114,182,0.08)']}
                  start={{ x: 0, y: 0 }}
                  end={{ x: 1, y: 0 }}
                  style={{ padding: 16 }}
                >
                  <Animated.View style={{ opacity: fadeAnim, transform: [{ scale: scaleAnim }] }}>
                    {response ? (
                      <Text fontSize="md">{response}</Text>
                    ) : (
                      <Text color="muted.500">Nonna is listening‚Ä¶ Mamma mia! üçï</Text>
                    )}
                  </Animated.View>
                </LinearGradient>
              </Box>

              {response ? (
                <HStack space="3">
                  <Button
                    flex={1}
                    onPress={() => speakItalian(response)}
                    colorScheme="primary"
                    rounded="lg"
                    variant="solid"
                    isLoading={isSpeaking}
                    isDisabled={isSpeaking || !response}
                  >
                    Hear Nonna Speak üé§
                  </Button>
                  <Button
                    flex={1}
                    onPress={onSaveFavorite}
                    colorScheme="rose"
                    rounded="lg"
                    variant="subtle"
                    isLoading={isSaving}
                    isDisabled={isSaving || !response}
                  >
                    Save to Favorites ‚ù§Ô∏è
                  </Button>
                </HStack>
              ) : null}
            </VStack>
          </Card>
        </VStack>
      </ScrollView>
    </Box>
  );
}
=======
import React, { useEffect, useState } from 'react';
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  ScrollView,
  StyleSheet,
  Alert,
} from 'react-native';

import { generateWisdom, PERSONALITIES, Personality } from '@/lib/nonna';
import { addFavorite, getFavorites, setPremium } from '@/lib/storage';

export default function HomeScreen() {
  const [question, setQuestion] = useState('');
  const [personality, setPersonality] = useState<Personality>('Sicilian Nonna');
  const [response, setResponse] = useState<string>('');
  const [isPremium, setIsPremium] = useState<boolean>(false);
  const [favoritesCount, setFavoritesCount] = useState<number>(0);

  const [isAsking, setIsAsking] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [isUpgrading, setIsUpgrading] = useState(false);
  const [isGesturing, setIsGesturing] = useState(false);

  useEffect(() => {
    let mounted = true;
    const init = async () => {
      try {
        const favs = await getFavorites();
        if (mounted) setFavoritesCount(favs.length);
      } catch (err) {
        console.error('Failed to load favorites', err);
        Alert.alert('Error', 'Error loading favorites. Please try again.');
      }
    };
    void init();
    return () => {
      mounted = false;
    };
  }, []);

  const onAskNonna = async () => {
    if (isAsking) return;
    if (!question.trim()) {
      Alert.alert('Mamma mia!', 'Type a question for Nonna first, amore.');
      return;
    }

    setIsAsking(true);
    try {
      const advice = generateWisdom(question.trim(), personality);
      setResponse(advice);
    } catch (err) {
      console.error('onAskNonna error', err);
      Alert.alert('Oops', 'Nonna is tired. Please try again.');
    } finally {
      setIsAsking(false);
    }
  };

  const onSaveFavorite = async () => {
    if (isSaving || !response) return;
    setIsSaving(true);
    try {
      await addFavorite(response);
      const favs = await getFavorites();
      setFavoritesCount(favs.length);
      Alert.alert('Saved ‚ù§Ô∏è', 'Nonna will remember this one.');
    } catch (err) {
      console.error('Failed to save favorite', err);
      Alert.alert('Error', 'Could not save favorite. Please try again.');
    } finally {
      setIsSaving(false);
    }
  };

  const onUpgrade = async () => {
    if (isUpgrading) return;
    setIsUpgrading(true);
    try {
      await setPremium(true);
      setIsPremium(true);
      Alert.alert('Grazie mille!', 'Premium unlocked. Nonna is yours, senza limiti! üíÉ');
    } catch (err) {
      console.error('Upgrade failed', err);
      Alert.alert('Error', 'Upgrade failed. Please try again.');
    } finally {
      setIsUpgrading(false);
    }
  };

  const onRecognizeGesture = () => {
    if (isGesturing) return;
    setIsGesturing(true);
    try {
      const gestures = [
        'ü§å The classic ‚ÄúMa che vuoi?‚Äù pinch detected. Translation: Use more garlic.',
        'ü§ü Cornicello detected! You are protected from the malocchio today.',
        '‚úã Open palm gesture detected. Nonna says: enough drama, eat something.',
        'üëâ Pointing gesture detected. Respect your elders and call your mother!',
      ];
      const pick = gestures[Math.floor(Math.random() * gestures.length)];
      setResponse(`Madonna santissima! Gesture recognized: ${pick}`);
    } catch (err) {
      console.error('Gesture recognition failed', err);
      Alert.alert('Error', 'Gesture recognition failed. Try again.');
    } finally {
      setTimeout(() => setIsGesturing(false), 600);
    }
  };

  const onGoToSuperstition = () => {
    Alert.alert(
      'Superstition Checker',
      'Please switch to the Superstition tab to use the camera-based checker.'
    );
  };

  return (
    <View style={styles.screen}>
      <ScrollView contentContainerStyle={styles.scroll}>
        <View style={styles.header}>
          <Text style={styles.headerTitle}>Nonna‚Äôs Wisdom & Superstition Oracle üáÆüáπ</Text>
          <Text style={styles.headerSubtitle}>Ask with respect, eat with gusto. üçùüç∑</Text>

          <View style={styles.personalityRow}>
            {PERSONALITIES.map((p) => {
              const selected = p === personality;
              return (
                <TouchableOpacity
                  key={p}
                  onPress={() => setPersonality(p)}
                  style={[styles.personalityChip, selected && styles.personalityChipSelected]}
                  disabled={isAsking}
                >
                  <Text style={[styles.personalityText, selected && styles.personalityTextSelected]}>
                    {p.replace(' Nonna', '')}
                  </Text>
                </TouchableOpacity>
              );
            })}
          </View>

          <View style={styles.statsRow}>
            <Text style={styles.statsText}>Favorites: {favoritesCount}</Text>
            {isPremium ? <Text style={styles.premiumBadge}>Premium</Text> : null}
          </View>
        </View>

        <View style={styles.card}>
          <Text style={styles.cardHint}>Ask Nonna anything‚Ä¶ (love, food, life, superstition)</Text>
          <TextInput
            value={question}
            onChangeText={setQuestion}
            placeholder="Type your question"
            placeholderTextColor="#868e96"
            style={styles.input}
            multiline
            editable={!isAsking}
          />

          <View style={styles.actionsRow}>
            <TouchableOpacity
              onPress={onAskNonna}
              disabled={isAsking || !question.trim()}
              style={[styles.primaryButton, (isAsking || !question.trim()) && styles.buttonDisabled]}
            >
              <Text style={styles.primaryButtonText}>
                {isAsking ? 'Thinking‚Ä¶' : 'Ask Nonna for Wisdom ü§å'}
              </Text>
            </TouchableOpacity>

            <TouchableOpacity
              onPress={onGoToSuperstition}
              style={[styles.secondaryButton]}
            >
              <Text style={styles.secondaryButtonText}>Check Superstition üîÆ</Text>
            </TouchableOpacity>
          </View>

          {!isPremium && (
            <TouchableOpacity
              onPress={onUpgrade}
              disabled={isUpgrading}
              style={[styles.outlineButton, isUpgrading && styles.buttonDisabled]}
            >
              <Text style={styles.outlineButtonText}>
                {isUpgrading ? 'Upgrading‚Ä¶' : 'Upgrade to Premium ‚Äì Unlimited Advice üíé'}
              </Text>
            </TouchableOpacity>
          )}

          <TouchableOpacity
            onPress={onRecognizeGesture}
            disabled={isGesturing}
            style={[styles.tertiaryButton, isGesturing && styles.buttonDisabled]}
          >
            <Text style={styles.tertiaryButtonText}>
              {isGesturing ? 'Analyzing‚Ä¶' : 'Recognize Hand Gesture (beta) ‚úãü§å'}
            </Text>
          </TouchableOpacity>
        </View>

        <View style={styles.card}>
          <Text style={styles.cardHint}>Nonna‚Äôs Response</Text>
          <View style={styles.responseBox}>
            {response ? (
              <Text style={styles.responseText}>{response}</Text>
            ) : (
              <Text style={styles.responsePlaceholder}>Nonna is listening‚Ä¶ Mamma mia! üçï</Text>
            )}
          </View>

          {response ? (
            <View style={styles.actionsRow}>
              <TouchableOpacity
                onPress={onSaveFavorite}
                disabled={isSaving}
                style={[styles.outlineButton, isSaving && styles.buttonDisabled, { flex: 1 }]}
              >
                <Text style={styles.outlineButtonText}>
                  {isSaving ? 'Saving‚Ä¶' : 'Save to Favorites ‚ù§Ô∏è'}
                </Text>
              </TouchableOpacity>
            </View>
          ) : null}
        </View>
      </ScrollView>
    </View>
  );
}

const COLORS = {
  background: '#f8f9fa',
  surface: '#ffffff',
  text: '#495057',
  subtle: '#868e96',
  primary: '#007bff',
  primaryDark: '#0069d9',
  border: '#e9ecef',
  shadow: '#000000',
};

const styles = StyleSheet.create({
  screen: {
    flex: 1,
    backgroundColor: COLORS.background,
  },
  scroll: {
    padding: 16,
    paddingBottom: 32,
  },
  header: {
    backgroundColor: '#eef2f7',
    borderRadius: 16,
    paddingVertical: 20,
    paddingHorizontal: 16,
    marginBottom: 16,
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.09,
    shadowOffset: { width: 0, height: 4 },
    shadowRadius: 12,
    elevation: 3,
    borderWidth: 1,
    borderColor: COLORS.border,
  },
  headerTitle: {
    fontSize: 20,
    fontWeight: '700',
    color: COLORS.text,
    textAlign: 'center',
  },
  headerSubtitle: {
    marginTop: 6,
    fontSize: 14,
    color: COLORS.subtle,
    textAlign: 'center',
  },
  personalityRow: {
    flexDirection: 'row',
    flexWrap: 'wrap',
    gap: 8,
    justifyContent: 'center',
    marginTop: 12,
  },
  personalityChip: {
    paddingVertical: 6,
    paddingHorizontal: 10,
    borderRadius: 16,
    borderWidth: 1,
    borderColor: COLORS.border,
    backgroundColor: '#ffffff',
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.05,
    shadowOffset: { width: 0, height: 2 },
    shadowRadius: 8,
    elevation: 2,
  },
  personalityChipSelected: {
    backgroundColor: COLORS.primary,
    borderColor: COLORS.primary,
  },
  personalityText: {
    fontSize: 12,
    color: COLORS.text,
  },
  personalityTextSelected: {
    color: '#ffffff',
    fontWeight: '600',
  },
  statsRow: {
    flexDirection: 'row',
    justifyContent: 'center',
    gap: 12,
    marginTop: 12,
  },
  statsText: {
    color: COLORS.text,
    fontWeight: '600',
  },
  premiumBadge: {
    color: COLORS.primary,
    fontWeight: '700',
  },
  card: {
    backgroundColor: COLORS.surface,
    borderRadius: 16,
    padding: 16,
    marginBottom: 16,
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.08,
    shadowOffset: { width: 0, height: 6 },
    shadowRadius: 14,
    elevation: 3,
    borderWidth: 1,
    borderColor: COLORS.border,
  },
  cardHint: {
    fontSize: 12,
    color: COLORS.subtle,
    marginBottom: 8,
  },
  input: {
    minHeight: 64,
    borderRadius: 12,
    borderWidth: 1,
    borderColor: COLORS.border,
    backgroundColor: '#ffffff',
    padding: 12,
    fontSize: 16,
    color: COLORS.text,
  },
  actionsRow: {
    flexDirection: 'row',
    gap: 12,
    marginTop: 12,
  },
  primaryButton: {
    flex: 1,
    backgroundColor: COLORS.primary,
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.15,
    shadowOffset: { width: 0, height: 4 },
    shadowRadius: 10,
    elevation: 3,
  },
  primaryButtonText: {
    color: '#ffffff',
    fontWeight: '700',
  },
  secondaryButton: {
    flex: 1,
    backgroundColor: '#ffffff',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
    borderWidth: 1,
    borderColor: COLORS.primary,
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.08,
    shadowOffset: { width: 0, height: 4 },
    shadowRadius: 10,
    elevation: 2,
  },
  secondaryButtonText: {
    color: COLORS.primary,
    fontWeight: '700',
  },
  outlineButton: {
    backgroundColor: '#ffffff',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
    borderWidth: 1,
    borderColor: COLORS.primary,
    marginTop: 10,
  },
  outlineButtonText: {
    color: COLORS.primary,
    fontWeight: '700',
  },
  tertiaryButton: {
    backgroundColor: '#f1f3f5',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
    marginTop: 10,
    borderWidth: 1,
    borderColor: COLORS.border,
  },
  tertiaryButtonText: {
    color: COLORS.text,
    fontWeight: '600',
  },
  buttonDisabled: {
    opacity: 0.7,
  },
  responseBox: {
    minHeight: 120,
    borderRadius: 12,
    borderWidth: 1,
    borderColor: COLORS.border,
    backgroundColor: '#ffffff',
    padding: 14,
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.05,
    shadowOffset: { width: 0, height: 3 },
    shadowRadius: 8,
    elevation: 2,
  },
  responseText: {
    fontSize: 16,
    lineHeight: 24,
    color: COLORS.text,
  },
  responsePlaceholder: {
    fontSize: 16,
    color: COLORS.subtle,
  },
});
>>>>>>> REPLACE
```

> Tokens: 38k sent, 6.0k received. Cost: $0.11 message, $0.76 session.  
> Applied edit to app/(tabs)/index.tsx  
> Commit 4d5b316 refactor: migrate to RN built-ins, drop native-base and expo deps  
> You can use /undo to undo and discard each aider commit.  

#### "Remove ALL native-base imports completely. Use only standard React Native and Expo components. Remove NativeBaseProvider, extendTheme, and any other native-base references. Keep only the basic Expo Router layout structure."  

app/_layout.tsx
```typescript
<<<<<<< SEARCH
import { NativeBaseProvider, extendTheme } from 'native-base';
import { LinearGradient } from 'expo-linear-gradient';
=======
>>>>>>> REPLACE
```

app/_layout.tsx
```typescript
<<<<<<< SEARCH
const theme = extendTheme({
  colors: {
    primary: {
      50: '#EEF2FF',
      100: '#E0E7FF',
      200: '#C7D2FE',
      300: '#A5B4FC',
      400: '#818CF8',
      500: '#6366F1',
      600: '#5459E6',
      700: '#4546D9',
      800: '#3738CA',
      900: '#2E30B3',
    },
  },
  components: {
    Button: {
      defaultProps: { rounded: 'lg' },
    },
    Input: {
      defaultProps: { rounded: 'lg', variant: 'filled', bg: 'muted.100', _dark: { bg: 'coolGray.700' } },
    },
  },
});
=======
>>>>>>> REPLACE
```

app/_layout.tsx
```typescript
<<<<<<< SEARCH
  return (
    <NativeBaseProvider theme={theme} config={{ dependencies: { 'linear-gradient': LinearGradient } }}>
      <ThemeProvider value={colorScheme === 'dark' ? DarkTheme : DefaultTheme}>
=======
  return (
    <ThemeProvider value={colorScheme === 'dark' ? DarkTheme : DefaultTheme}>
>>>>>>> REPLACE
```

app/_layout.tsx
```typescript
<<<<<<< SEARCH
      </ThemeProvider>
    </NativeBaseProvider>
  );
=======
      </ThemeProvider>
  );
>>>>>>> REPLACE
```

> Tokens: 44k sent, 361 received. Cost: $0.06 message, $0.82 session.  
> Applied edit to app/_layout.tsx  
> Commit 9731141 refactor: remove native-base and theming; keep Expo Router layout  
> You can use /undo to undo and discard each aider commit.  

#### app/\(tabs\)/index.tsx --message "Improve text readability and visual design while keeping Italian theme:  
#### 1. Increase text contrast - use white text on dark backgrounds, dark text on light backgrounds  
#### 2. Add subtle background colors or cards to separate content sections  
#### 3. Improve font sizes - make sure all text is easily readable  
#### 4. Add proper spacing between elements  
#### 5. Make buttons more prominent with better contrast  
#### 6. Keep the Italian colors but use them as accents, not full backgrounds  
#### 7. Add text shadows or background overlays where needed for readability  
#### 8. Ensure 'Questions left' and 'Favorites' counters are clearly visible"  
#### Add Working Italian Voice:  
#### app/\(tabs\)/index.tsx --message "Fix the Italian text-to-speech feature:  
#### 1. Import * as Speech from 'expo-speech'  
#### 2. Add a 'Hear Nonna Speak' button next to each response  
#### 3. Use Speech.speak() with these settings: {language: 'it-IT', rate: 0.6, pitch: 0.9}  
#### 4. Make sure the voice button actually works when clicked  
#### 5. Add visual feedback when speaking (like changing button text to 'Speaking...')  
#### 6. Handle cases where TTS isn't available gracefully"  
#### Professional Polish:  
#### app/\(tabs\)/index.tsx --message "Add professional touches:  
#### 1. Add subtle animations when responses appear  
#### 2. Improve button styling with proper hover states  
#### 3. Add loading indicators when waiting for responses  
#### 4. Make the interface feel more responsive and polished  
#### 5. Keep all the Italian personality but make it production-ready"  
####   
####  

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import React, { useEffect, useState } from 'react';
=======
import React, { useEffect, useRef, useState } from 'react';
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  ScrollView,
  StyleSheet,
  Alert,
} from 'react-native';
=======
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  ScrollView,
  StyleSheet,
  Alert,
  ActivityIndicator,
  Animated,
} from 'react-native';
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
} from 'react-native';

import { generateWisdom, PERSONALITIES, Personality } from '@/lib/nonna';
=======
} from 'react-native';
import * as Speech from 'expo-speech';

import { generateWisdom, PERSONALITIES, Personality } from '@/lib/nonna';
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const [isGesturing, setIsGesturing] = useState(false);
=======
  const [isGesturing, setIsGesturing] = useState(false);
  const [isSpeaking, setIsSpeaking] = useState(false);
  const [isTtsAvailable, setIsTtsAvailable] = useState(true);
  const fadeAnim = useRef(new Animated.Value(0)).current;
  const scaleAnim = useRef(new Animated.Value(0.98)).current;
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  }, []);
=======
  }, []);

  useEffect(() => {
    let mounted = true;
    (async () => {
      try {
        const voices = await Speech.getAvailableVoicesAsync?.();
        if (mounted) {
          if (Array.isArray(voices) && voices.length > 0) {
            setIsTtsAvailable(true);
          } else {
            setIsTtsAvailable(false);
          }
        }
      } catch {
        if (mounted) setIsTtsAvailable(false);
      }
    })();
    return () => {
      mounted = false;
      try {
        Speech.stop();
      } catch {}
    };
  }, []);
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const onAskNonna = async () => {
=======
  const animateResponse = () => {
    fadeAnim.setValue(0);
    scaleAnim.setValue(0.98);
    Animated.parallel([
      Animated.timing(fadeAnim, { toValue: 1, duration: 400, useNativeDriver: true }),
      Animated.spring(scaleAnim, { toValue: 1, useNativeDriver: true, friction: 6, tension: 80 }),
    ]).start();
  };

  const onAskNonna = async () => {
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
      const advice = generateWisdom(question.trim(), personality);
      setResponse(advice);
=======
      const advice = generateWisdom(question.trim(), personality);
      setResponse(advice);
      animateResponse();
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
      setResponse(`Madonna santissima! Gesture recognized: ${pick}`);
=======
      setResponse(`Madonna santissima! Gesture recognized: ${pick}`);
      animateResponse();
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  };

  const onGoToSuperstition = () => {
=======
  };

  const speakItalian = () => {
    if (!response) return;
    if (!isTtsAvailable) {
      Alert.alert('Speech unavailable', 'Italian voice is not available on this device.');
      return;
    }
    setIsSpeaking(true);
    try {
      Speech.stop();
      Speech.speak(response, {
        language: 'it-IT',
        rate: 0.6,
        pitch: 0.9,
        onDone: () => setIsSpeaking(false),
        onStopped: () => setIsSpeaking(false),
        onError: () => setIsSpeaking(false),
      });
    } catch (e) {
      setIsSpeaking(false);
      Alert.alert('Speech error', 'Unable to speak right now.');
    }
  };

  const onGoToSuperstition = () => {
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
          <View style={styles.statsRow}>
            <Text style={styles.statsText}>Favorites: {favoritesCount}</Text>
            {isPremium ? <Text style={styles.premiumBadge}>Premium</Text> : null}
          </View>
=======
          <View style={styles.statsRow}>
            <Text style={styles.statsText}><Text style={styles.statsLabel}>Questions:</Text> Unlimited</Text>
            <Text style={styles.statsText}><Text style={styles.statsLabel}>Favorites:</Text> {favoritesCount}</Text>
            {isPremium ? <Text style={styles.premiumBadge}>Premium</Text> : null}
          </View>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
            {PERSONALITIES.map((p) => {
              const selected = p === personality;
              return (
                <TouchableOpacity
                  key={p}
                  onPress={() => setPersonality(p)}
                  style={[styles.personalityChip, selected && styles.personalityChipSelected]}
                  disabled={isAsking}
                >
=======
            {PERSONALITIES.map((p) => {
              const selected = p === personality;
              return (
                <TouchableOpacity
                  key={p}
                  onPress={() => setPersonality(p)}
                  style={[styles.personalityChip, selected && styles.personalityChipSelected]}
                  disabled={isAsking}
                  activeOpacity={0.8}
                >
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
            <TouchableOpacity
              onPress={onAskNonna}
              disabled={isAsking || !question.trim()}
              style={[styles.primaryButton, (isAsking || !question.trim()) && styles.buttonDisabled]}
            >
              <Text style={styles.primaryButtonText}>
                {isAsking ? 'Thinking‚Ä¶' : 'Ask Nonna for Wisdom ü§å'}
              </Text>
            </TouchableOpacity>
=======
            <TouchableOpacity
              onPress={onAskNonna}
              disabled={isAsking || !question.trim()}
              activeOpacity={0.8}
              style={[styles.primaryButton, (isAsking || !question.trim()) && styles.buttonDisabled]}
            >
              {isAsking ? (
                <View style={styles.buttonContentRow}>
                  <ActivityIndicator color="#ffffff" style={{ marginRight: 8 }} />
                  <Text style={styles.primaryButtonText}>Thinking‚Ä¶</Text>
                </View>
              ) : (
                <Text style={styles.primaryButtonText}>Ask Nonna for Wisdom ü§å</Text>
              )}
            </TouchableOpacity>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
            <TouchableOpacity
              onPress={onGoToSuperstition}
              style={[styles.secondaryButton]}
            >
=======
            <TouchableOpacity
              onPress={onGoToSuperstition}
              activeOpacity={0.8}
              style={[styles.secondaryButton]}
            >
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
            <TouchableOpacity
              onPress={onUpgrade}
              disabled={isUpgrading}
              style={[styles.outlineButton, isUpgrading && styles.buttonDisabled]}
            >
=======
            <TouchableOpacity
              onPress={onUpgrade}
              disabled={isUpgrading}
              activeOpacity={0.8}
              style={[styles.outlineButton, isUpgrading && styles.buttonDisabled]}
            >
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
          <TouchableOpacity
            onPress={onRecognizeGesture}
            disabled={isGesturing}
            style={[styles.tertiaryButton, isGesturing && styles.buttonDisabled]}
          >
=======
          <TouchableOpacity
            onPress={onRecognizeGesture}
            disabled={isGesturing}
            activeOpacity={0.8}
            style={[styles.tertiaryButton, isGesturing && styles.buttonDisabled]}
          >
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
          <View style={styles.responseBox}>
            {response ? (
              <Text style={styles.responseText}>{response}</Text>
            ) : (
              <Text style={styles.responsePlaceholder}>Nonna is listening‚Ä¶ Mamma mia! üçï</Text>
            )}
          </View>
=======
          <View style={styles.responseBox}>
            <Animated.View style={{ opacity: fadeAnim, transform: [{ scale: scaleAnim }] }}>
              {response ? (
                <Text style={styles.responseText}>{response}</Text>
              ) : (
                <Text style={styles.responsePlaceholder}>Nonna is listening‚Ä¶ Mamma mia! üçï</Text>
              )}
            </Animated.View>
          </View>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
          {response ? (
            <View style={styles.actionsRow}>
              <TouchableOpacity
                onPress={onSaveFavorite}
                disabled={isSaving}
                style={[styles.outlineButton, isSaving && styles.buttonDisabled, { flex: 1 }]}
              >
                <Text style={styles.outlineButtonText}>
                  {isSaving ? 'Saving‚Ä¶' : 'Save to Favorites ‚ù§Ô∏è'}
                </Text>
              </TouchableOpacity>
            </View>
          ) : null}
=======
          {response ? (
            <View style={styles.actionsRow}>
              <TouchableOpacity
                onPress={speakItalian}
                disabled={isSpeaking || !response}
                activeOpacity={0.8}
                style={[styles.primaryButton, (isSpeaking || !response) && styles.buttonDisabled, { flex: 1 }]}
              >
                <Text style={styles.primaryButtonText}>
                  {isSpeaking ? 'Speaking‚Ä¶' : 'Hear Nonna Speak üé§'}
                </Text>
              </TouchableOpacity>

              <TouchableOpacity
                onPress={onSaveFavorite}
                disabled={isSaving}
                activeOpacity={0.8}
                style={[styles.outlineButton, isSaving && styles.buttonDisabled, { flex: 1 }]}
              >
                <Text style={styles.outlineButtonText}>
                  {isSaving ? 'Saving‚Ä¶' : 'Save to Favorites ‚ù§Ô∏è'}
                </Text>
              </TouchableOpacity>
            </View>
          ) : null}
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  headerTitle: {
    fontSize: 20,
    fontWeight: '700',
    color: COLORS.text,
    textAlign: 'center',
  },
=======
  headerTitle: {
    fontSize: 22,
    fontWeight: '700',
    color: COLORS.text,
    textAlign: 'center',
    textShadowColor: 'rgba(0,0,0,0.05)',
    textShadowOffset: { width: 0, height: 1 },
    textShadowRadius: 2,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  headerSubtitle: {
    marginTop: 6,
    fontSize: 14,
    color: COLORS.subtle,
    textAlign: 'center',
  },
=======
  headerSubtitle: {
    marginTop: 6,
    fontSize: 15,
    color: COLORS.subtle,
    textAlign: 'center',
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  statsRow: {
    flexDirection: 'row',
    justifyContent: 'center',
    gap: 12,
    marginTop: 12,
  },
=======
  statsRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    gap: 12,
    marginTop: 12,
    backgroundColor: '#ffffff',
    borderRadius: 12,
    paddingVertical: 8,
    paddingHorizontal: 12,
    borderWidth: 1,
    borderColor: COLORS.border,
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.05,
    shadowOffset: { width: 0, height: 2 },
    shadowRadius: 8,
    elevation: 2,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  statsText: {
    color: COLORS.text,
    fontWeight: '600',
  },
  premiumBadge: {
=======
  statsText: {
    color: COLORS.text,
    fontWeight: '600',
  },
  statsLabel: {
    color: COLORS.text,
    fontWeight: '700',
  },
  premiumBadge: {
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  cardHint: {
    fontSize: 12,
    color: COLORS.subtle,
    marginBottom: 8,
  },
=======
  cardHint: {
    fontSize: 14,
    color: COLORS.subtle,
    marginBottom: 8,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  primaryButtonText: {
    color: '#ffffff',
    fontWeight: '700',
  },
=======
  primaryButtonText: {
    color: '#ffffff',
    fontWeight: '700',
  },
  buttonContentRow: { flexDirection: 'row', alignItems: 'center', justifyContent: 'center' },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  responseText: {
    fontSize: 16,
    lineHeight: 24,
    color: COLORS.text,
  },
=======
  responseText: {
    fontSize: 17,
    lineHeight: 24,
    color: COLORS.text,
  },
>>>>>>> REPLACE
```

> Tokens: 45k sent, 2.9k received. Cost: $0.09 message, $0.91 session.  
> Applied edit to app/(tabs)/index.tsx  
> Commit 46d4242 feat: add Italian TTS, response animations, and UI polish  
> You can use /undo to undo and discard each aider commit.  

####   
####   
#### app/\(tabs\)/index.tsx --message "Improve text readability and visual design while keeping Italian theme:  
#### 1. Increase text contrast - use white text on dark backgrounds, dark text on light backgrounds  
#### 2. Add subtle background colors or cards to separate content sections  
#### 3. Improve font sizes - make sure all text is easily readable  
#### 4. Add proper spacing between elements  
#### 5. Make buttons more prominent with better contrast  
#### 6. Keep the Italian colors but use them as accents, not full backgrounds  
#### 7. Add text shadows or background overlays where needed for readability  
#### 8. Ensure 'Questions left' and 'Favorites' counters are clearly visible"  
#### Add Working Italian Voice:  
#### app/\(tabs\)/index.tsx --message "Fix the Italian text-to-speech feature:  
#### 1. Import * as Speech from 'expo-speech'  
#### 2. Add a 'Hear Nonna Speak' button next to each response  
#### 3. Use Speech.speak() with these settings: {language: 'it-IT', rate: 0.6, pitch: 0.9}  
#### 4. Make sure the voice button actually works when clicked  
#### 5. Add visual feedback when speaking (like changing button text to 'Speaking...')  
#### 6. Handle cases where TTS isn't available gracefully"  
#### Professional Polish:  
#### app/\(tabs\)/index.tsx --message "Add professional touches:  
#### 1. Add subtle animations when responses appear  
#### 2. Improve button styling with proper hover states  
#### 3. Add loading indicators when waiting for responses  
#### 4. Make the interface feel more responsive and polished  
#### 5. Keep all the Italian personality but make it production-ready"  
#### app/\(tabs\)/index.tsx --message "Make these specific visual improvements:  
#### 1. Change the text input backgroundColor to '#f8f9fa' and color to '#000'  
#### 2. Add backgroundColor: '#ffffff' to the response area with padding: 20  
#### 3. Change all dark text to color: '#333333' for better readability  
#### 4. Add borderRadius: 8 to all buttons and inputs  
#### 5. Increase fontSize to at least 16 for all text  
#### 6. Add marginVertical: 10 between all major sections"  
#### app/\(tabs\)/index.tsx --message "Add working Italian text-to-speech functionality:  
####   
#### 1. Import Speech from expo-speech at the top: import * as Speech from 'expo-speech'  
#### 2. Create a speakResponse function that uses Speech.speak() with these exact options:  
####    - language: 'it-IT'  
####    - rate: 0.6  
####    - pitch: 0.9  
#### 3. Add a 'Hear Nonna Speak' button right next to where the response appears  
#### 4. When clicked, it should read the current Nonna response aloud in Italian  
#### 5. Add error handling in case speech isn't available  
#### 6. Test the button by adding console.log statements to verify it's being called  
####   
#### Make sure the Speech.speak function is actually called when the button is pressed."  

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const speakItalian = () => {
    if (!response) return;
    if (!isTtsAvailable) {
      Alert.alert('Speech unavailable', 'Italian voice is not available on this device.');
      return;
    }
    setIsSpeaking(true);
    try {
      Speech.stop();
      Speech.speak(response, {
        language: 'it-IT',
        rate: 0.6,
        pitch: 0.9,
        onDone: () => setIsSpeaking(false),
        onStopped: () => setIsSpeaking(false),
        onError: () => setIsSpeaking(false),
      });
    } catch (e) {
      setIsSpeaking(false);
      Alert.alert('Speech error', 'Unable to speak right now.');
    }
  };
=======
  const speakResponse = () => {
    if (!response) return;
    if (!isTtsAvailable) {
      Alert.alert('Speech unavailable', 'Italian voice is not available on this device.');
      return;
    }
    console.log('speakResponse called');
    setIsSpeaking(true);
    try {
      Speech.stop();
      Speech.speak(response, {
        language: 'it-IT',
        rate: 0.6,
        pitch: 0.9,
        onDone: () => setIsSpeaking(false),
        onStopped: () => setIsSpeaking(false),
        onError: () => setIsSpeaking(false),
      });
    } catch (e) {
      setIsSpeaking(false);
      Alert.alert('Speech error', 'Unable to speak right now.');
    }
  };
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
                onPress={speakItalian}
=======
                onPress={speakResponse}
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  text: '#495057',
=======
  text: '#333333',
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  header: {
    backgroundColor: '#eef2f7',
    borderRadius: 16,
    paddingVertical: 20,
    paddingHorizontal: 16,
    marginBottom: 16,
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.09,
    shadowOffset: { width: 0, height: 4 },
    shadowRadius: 12,
    elevation: 3,
    borderWidth: 1,
    borderColor: COLORS.border,
  },
=======
  header: {
    backgroundColor: '#eef2f7',
    borderRadius: 16,
    paddingVertical: 20,
    paddingHorizontal: 16,
    marginBottom: 16,
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.09,
    shadowOffset: { width: 0, height: 4 },
    shadowRadius: 12,
    elevation: 3,
    borderWidth: 1,
    borderColor: COLORS.border,
    borderTopWidth: 4,
    borderTopColor: '#CE2B37',
    borderBottomWidth: 4,
    borderBottomColor: '#009246',
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  headerSubtitle: {
    marginTop: 6,
    fontSize: 15,
    color: COLORS.subtle,
    textAlign: 'center',
  },
=======
  headerSubtitle: {
    marginTop: 6,
    fontSize: 16,
    color: COLORS.subtle,
    textAlign: 'center',
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  personalityText: {
    fontSize: 12,
    color: COLORS.text,
  },
=======
  personalityText: {
    fontSize: 16,
    color: COLORS.text,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  statsText: {
    color: COLORS.text,
    fontWeight: '600',
  },
=======
  statsText: {
    color: COLORS.text,
    fontWeight: '600',
    fontSize: 16,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  cardHint: {
    fontSize: 14,
    color: COLORS.subtle,
    marginBottom: 8,
  },
=======
  cardHint: {
    fontSize: 16,
    color: COLORS.subtle,
    marginBottom: 8,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  input: {
    minHeight: 64,
    borderRadius: 12,
    borderWidth: 1,
    borderColor: COLORS.border,
    backgroundColor: '#ffffff',
    padding: 12,
    fontSize: 16,
    color: COLORS.text,
  },
=======
  input: {
    minHeight: 64,
    borderRadius: 8,
    borderWidth: 1,
    borderColor: COLORS.border,
    backgroundColor: '#f8f9fa',
    padding: 12,
    fontSize: 16,
    color: '#000',
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  primaryButton: {
    flex: 1,
    backgroundColor: COLORS.primary,
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.15,
    shadowOffset: { width: 0, height: 4 },
    shadowRadius: 10,
    elevation: 3,
  },
=======
  primaryButton: {
    flex: 1,
    backgroundColor: COLORS.primary,
    paddingVertical: 12,
    borderRadius: 8,
    alignItems: 'center',
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.15,
    shadowOffset: { width: 0, height: 4 },
    shadowRadius: 10,
    elevation: 3,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  primaryButtonText: {
    color: '#ffffff',
    fontWeight: '700',
  },
=======
  primaryButtonText: {
    color: '#ffffff',
    fontWeight: '700',
    fontSize: 16,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  secondaryButton: {
    flex: 1,
    backgroundColor: '#ffffff',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
    borderWidth: 1,
    borderColor: COLORS.primary,
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.08,
    shadowOffset: { width: 0, height: 4 },
    shadowRadius: 10,
    elevation: 2,
  },
=======
  secondaryButton: {
    flex: 1,
    backgroundColor: '#ffffff',
    paddingVertical: 12,
    borderRadius: 8,
    alignItems: 'center',
    borderWidth: 1,
    borderColor: COLORS.primary,
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.08,
    shadowOffset: { width: 0, height: 4 },
    shadowRadius: 10,
    elevation: 2,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  secondaryButtonText: {
    color: COLORS.primary,
    fontWeight: '700',
  },
=======
  secondaryButtonText: {
    color: COLORS.primary,
    fontWeight: '700',
    fontSize: 16,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  outlineButton: {
    backgroundColor: '#ffffff',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
    borderWidth: 1,
    borderColor: COLORS.primary,
    marginTop: 10,
  },
=======
  outlineButton: {
    backgroundColor: '#ffffff',
    paddingVertical: 12,
    borderRadius: 8,
    alignItems: 'center',
    borderWidth: 1,
    borderColor: COLORS.primary,
    marginTop: 10,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  outlineButtonText: {
    color: COLORS.primary,
    fontWeight: '700',
  },
=======
  outlineButtonText: {
    color: COLORS.primary,
    fontWeight: '700',
    fontSize: 16,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  tertiaryButton: {
    backgroundColor: '#f1f3f5',
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
    marginTop: 10,
    borderWidth: 1,
    borderColor: COLORS.border,
  },
=======
  tertiaryButton: {
    backgroundColor: '#f1f3f5',
    paddingVertical: 12,
    borderRadius: 8,
    alignItems: 'center',
    marginTop: 10,
    borderWidth: 1,
    borderColor: COLORS.border,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  tertiaryButtonText: {
    color: COLORS.text,
    fontWeight: '600',
  },
=======
  tertiaryButtonText: {
    color: COLORS.text,
    fontWeight: '600',
    fontSize: 16,
  },
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  responseBox: {
    minHeight: 120,
    borderRadius: 12,
    borderWidth: 1,
    borderColor: COLORS.border,
    backgroundColor: '#ffffff',
    padding: 14,
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.05,
    shadowOffset: { width: 0, height: 3 },
    shadowRadius: 8,
    elevation: 2,
  },
=======
  responseBox: {
    minHeight: 120,
    borderRadius: 8,
    borderWidth: 1,
    borderColor: COLORS.border,
    backgroundColor: '#ffffff',
    padding: 20,
    shadowColor: COLORS.shadow,
    shadowOpacity: 0.05,
    shadowOffset: { width: 0, height: 3 },
    shadowRadius: 8,
    elevation: 2,
  },
>>>>>>> REPLACE
```

> Tokens: 49k sent, 2.1k received. Cost: $0.08 message, $0.99 session.  
> Applied edit to app/(tabs)/index.tsx  
> Commit 7beb2fa refactor: rename speakItalian to speakResponse and wire TTS button  
> You can use /undo to undo and discard each aider commit.  

#### 1. Make sure expo-speech is properly imported: import * as Speech from 'expo-speech'  
#### 2. Add a simple speakNonna function that actually works  
#### 3. Add a visible 'Hear Nonna' button next to responses  
#### 4. Use basic Speech.speak(text, {language: 'it'}) - keep it simple  
#### 5. Remove any complex speech code that's causing errors  
#### 6. Just get basic speech working again like it was before"  

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const [isGesturing, setIsGesturing] = useState(false);
  const [isSpeaking, setIsSpeaking] = useState(false);
  const [isTtsAvailable, setIsTtsAvailable] = useState(true);
  const fadeAnim = useRef(new Animated.Value(0)).current;
=======
  const [isGesturing, setIsGesturing] = useState(false);
  const [isSpeaking, setIsSpeaking] = useState(false);
  const fadeAnim = useRef(new Animated.Value(0)).current;
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  useEffect(() => {
    let mounted = true;
    (async () => {
      try {
        const voices = await Speech.getAvailableVoicesAsync?.();
        if (mounted) {
          if (Array.isArray(voices) && voices.length > 0) {
            setIsTtsAvailable(true);
          } else {
            setIsTtsAvailable(false);
          }
        }
      } catch {
        if (mounted) setIsTtsAvailable(false);
      }
    })();
    return () => {
      mounted = false;
      try {
        Speech.stop();
      } catch {}
    };
  }, []);
=======
  useEffect(() => {
    return () => {
      try {
        Speech.stop();
      } catch {}
    };
  }, []);
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const speakResponse = () => {
    if (!response) return;
    if (!isTtsAvailable) {
      Alert.alert('Speech unavailable', 'Italian voice is not available on this device.');
      return;
    }
    console.log('speakResponse called');
    setIsSpeaking(true);
    try {
      Speech.stop();
      Speech.speak(response, {
        language: 'it-IT',
        rate: 0.6,
        pitch: 0.9,
        onDone: () => setIsSpeaking(false),
        onStopped: () => setIsSpeaking(false),
        onError: () => setIsSpeaking(false),
      });
    } catch (e) {
      setIsSpeaking(false);
      Alert.alert('Speech error', 'Unable to speak right now.');
    }
  };
=======
  const speakNonna = () => {
    if (!response) return;
    console.log('speakNonna called');
    setIsSpeaking(true);
    try {
      Speech.stop();
      Speech.speak(response, {
        language: 'it',
        onDone: () => setIsSpeaking(false),
        onStopped: () => setIsSpeaking(false),
        onError: () => setIsSpeaking(false),
      });
    } catch (e) {
      setIsSpeaking(false);
      Alert.alert('Speech error', 'Unable to speak right now.');
    }
  };
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
              <TouchableOpacity
                onPress={speakResponse}
                disabled={isSpeaking || !response}
                activeOpacity={0.8}
                style={[styles.primaryButton, (isSpeaking || !response) && styles.buttonDisabled, { flex: 1 }]}
              >
                <Text style={styles.primaryButtonText}>
                  {isSpeaking ? 'Speaking‚Ä¶' : 'Hear Nonna Speak üé§'}
                </Text>
              </TouchableOpacity>
=======
              <TouchableOpacity
                onPress={speakNonna}
                disabled={isSpeaking || !response}
                activeOpacity={0.8}
                style={[styles.primaryButton, (isSpeaking || !response) && styles.buttonDisabled, { flex: 1 }]}
              >
                <Text style={styles.primaryButtonText}>
                  {isSpeaking ? 'Speaking‚Ä¶' : 'Hear Nonna'}
                </Text>
              </TouchableOpacity>
>>>>>>> REPLACE
```

> Tokens: 52k sent, 786 received. Cost: $0.07 message, $1.06 session.  
> Applied edit to app/(tabs)/index.tsx  
> Commit a2cf5b4 fix: restore basic expo-speech with speakNonna and Hear Nonna button  
> You can use /undo to undo and discard each aider commit.  

#### aider app/\(tabs\)/index.tsx --message "Restore basic working functionality:  
#### 1. Remove ALL broken features temporarily  
#### 2. Get speech working with simple expo-speech again  
#### 3. Remove complex styling that may have broken things  
#### 4. Make it functional first, pretty second  
#### 5. Ensure unlimited questions still work"  

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  ScrollView,
  StyleSheet,
  Alert,
  ActivityIndicator,
  Animated,
} from 'react-native';
=======
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  ScrollView,
  StyleSheet,
  Alert,
  ActivityIndicator,
} from 'react-native';
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import { addFavorite, getFavorites, setPremium } from '@/lib/storage';
=======
 // Storage features temporarily disabled for basic functionality
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const [question, setQuestion] = useState('');
  const [personality, setPersonality] = useState<Personality>('Sicilian Nonna');
  const [response, setResponse] = useState<string>('');
  const [isPremium, setIsPremium] = useState<boolean>(false);
  const [favoritesCount, setFavoritesCount] = useState<number>(0);

  const [isAsking, setIsAsking] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [isUpgrading, setIsUpgrading] = useState(false);
  const [isGesturing, setIsGesturing] = useState(false);
  const [isSpeaking, setIsSpeaking] = useState(false);
  const fadeAnim = useRef(new Animated.Value(0)).current;
  const scaleAnim = useRef(new Animated.Value(0.98)).current;
=======
  const [question, setQuestion] = useState('');
  const [personality, setPersonality] = useState<Personality>('Sicilian Nonna');
  const [response, setResponse] = useState<string>('');
  const [isAsking, setIsAsking] = useState(false);
  const [isSpeaking, setIsSpeaking] = useState(false);
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  useEffect(() => {
    let mounted = true;
    const init = async () => {
      try {
        const favs = await getFavorites();
        if (mounted) setFavoritesCount(favs.length);
      } catch (err) {
        console.error('Failed to load favorites', err);
        Alert.alert('Error', 'Error loading favorites. Please try again.');
      }
    };
    void init();
    return () => {
      mounted = false;
    };
  }, []);
=======
  useEffect(() => {
    // Basic mode: no startup work needed
  }, []);
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const animateResponse = () => {
    fadeAnim.setValue(0);
    scaleAnim.setValue(0.98);
    Animated.parallel([
      Animated.timing(fadeAnim, { toValue: 1, duration: 400, useNativeDriver: true }),
      Animated.spring(scaleAnim, { toValue: 1, useNativeDriver: true, friction: 6, tension: 80 }),
    ]).start();
  };
=======
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
      const advice = generateWisdom(question.trim(), personality);
      setResponse(advice);
      animateResponse();
=======
      const advice = generateWisdom(question.trim(), personality);
      setResponse(advice);
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const onSaveFavorite = async () => {
    if (isSaving || !response) return;
    setIsSaving(true);
    try {
      await addFavorite(response);
      const favs = await getFavorites();
      setFavoritesCount(favs.length);
      Alert.alert('Saved ‚ù§Ô∏è', 'Nonna will remember this one.');
    } catch (err) {
      console.error('Failed to save favorite', err);
      Alert.alert('Error', 'Could not save favorite. Please try again.');
    } finally {
      setIsSaving(false);
    }
  };
=======
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const onUpgrade = async () => {
    if (isUpgrading) return;
    setIsUpgrading(true);
    try {
      await setPremium(true);
      setIsPremium(true);
      Alert.alert('Grazie mille!', 'Premium unlocked. Nonna is yours, senza limiti! üíÉ');
    } catch (err) {
      console.error('Upgrade failed', err);
      Alert.alert('Error', 'Upgrade failed. Please try again.');
    } finally {
      setIsUpgrading(false);
    }
  };
=======
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
  const onRecognizeGesture = () => {
    if (isGesturing) return;
    setIsGesturing(true);
    try {
      const gestures = [
        'ü§å The classic ‚ÄúMa che vuoi?‚Äù pinch detected. Translation: Use more garlic.',
        'ü§ü Cornicello detected! You are protected from the malocchio today.',
        '‚úã Open palm gesture detected. Nonna says: enough drama, eat something.',
        'üëâ Pointing gesture detected. Respect your elders and call your mother!',
      ];
      const pick = gestures[Math.floor(Math.random() * gestures.length)];
      setResponse(`Madonna santissima! Gesture recognized: ${pick}`);
      animateResponse();
    } catch (err) {
      console.error('Gesture recognition failed', err);
      Alert.alert('Error', 'Gesture recognition failed. Try again.');
    } finally {
      setTimeout(() => setIsGesturing(false), 600);
    }
  };
=======
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
          <View style={styles.statsRow}>
            <Text style={styles.statsText}><Text style={styles.statsLabel}>Questions:</Text> Unlimited</Text>
            <Text style={styles.statsText}><Text style={styles.statsLabel}>Favorites:</Text> {favoritesCount}</Text>
            {isPremium ? <Text style={styles.premiumBadge}>Premium</Text> : null}
          </View>
=======
          <View style={styles.statsRow}>
            <Text style={styles.statsText}><Text style={styles.statsLabel}>Questions:</Text> Unlimited</Text>
          </View>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
          {!isPremium && (
            <TouchableOpacity
              onPress={onUpgrade}
              disabled={isUpgrading}
              activeOpacity={0.8}
              style={[styles.outlineButton, isUpgrading && styles.buttonDisabled]}
            >
              <Text style={styles.outlineButtonText}>
                {isUpgrading ? 'Upgrading‚Ä¶' : 'Upgrade to Premium ‚Äì Unlimited Advice üíé'}
              </Text>
            </TouchableOpacity>
          )}

          <TouchableOpacity
            onPress={onRecognizeGesture}
            disabled={isGesturing}
            activeOpacity={0.8}
            style={[styles.tertiaryButton, isGesturing && styles.buttonDisabled]}
          >
            <Text style={styles.tertiaryButtonText}>
              {isGesturing ? 'Analyzing‚Ä¶' : 'Recognize Hand Gesture (beta) ‚úãü§å'}
            </Text>
          </TouchableOpacity>
=======
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
          <View style={styles.responseBox}>
            <Animated.View style={{ opacity: fadeAnim, transform: [{ scale: scaleAnim }] }}>
              {response ? (
                <Text style={styles.responseText}>{response}</Text>
              ) : (
                <Text style={styles.responsePlaceholder}>Nonna is listening‚Ä¶ Mamma mia! üçï</Text>
              )}
            </Animated.View>
          </View>
=======
          <View style={styles.responseBox}>
            {response ? (
              <Text style={styles.responseText}>{response}</Text>
            ) : (
              <Text style={styles.responsePlaceholder}>Nonna is listening‚Ä¶ Mamma mia! üçï</Text>
            )}
          </View>
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
          {response ? (
            <View style={styles.actionsRow}>
              <TouchableOpacity
                onPress={speakNonna}
                disabled={isSpeaking || !response}
                activeOpacity={0.8}
                style={[styles.primaryButton, (isSpeaking || !response) && styles.buttonDisabled, { flex: 1 }]}
              >
                <Text style={styles.primaryButtonText}>
                  {isSpeaking ? 'Speaking‚Ä¶' : 'Hear Nonna'}
                </Text>
              </TouchableOpacity>

              <TouchableOpacity
                onPress={onSaveFavorite}
                disabled={isSaving}
                activeOpacity={0.8}
                style={[styles.outlineButton, isSaving && styles.buttonDisabled, { flex: 1 }]}
              >
                <Text style={styles.outlineButtonText}>
                  {isSaving ? 'Saving‚Ä¶' : 'Save to Favorites ‚ù§Ô∏è'}
                </Text>
              </TouchableOpacity>
            </View>
          ) : null}
=======
          {response ? (
            <View style={styles.actionsRow}>
              <TouchableOpacity
                onPress={speakNonna}
                disabled={isSpeaking || !response}
                activeOpacity={0.8}
                style={[styles.primaryButton, (isSpeaking || !response) && styles.buttonDisabled, { flex: 1 }]}
              >
                <Text style={styles.primaryButtonText}>
                  {isSpeaking ? 'Speaking‚Ä¶' : 'Hear Nonna'}
                </Text>
              </TouchableOpacity>
            </View>
          ) : null}
>>>>>>> REPLACE
```

> Tokens: 52k sent, 2.0k received. Cost: $0.09 message, $1.15 session.  
> Applied edit to app/(tabs)/index.tsx  
> Commit 12bcce6 refactor: strip to basic functionality by removing extras  
> You can use /undo to undo and discard each aider commit.  

#### app/\(tabs\)/superstition.tsx --message "Fix the superstition tab so it actually loads a camera interface instead of showing 'switch to tab' message:  
#### 1. Create a proper React component that renders a camera screen  
#### 2. Import expo-camera if available, or create a placeholder camera interface  
#### 3. Remove the popup message about switching tabs  
#### 4. Add a 'Take Photo' button that triggers superstition analysis  
#### 5. Make it actually function as a superstition checker screen"  

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
import { StyleSheet, View, Pressable, Alert, ScrollView } from 'react-native';
=======
import { StyleSheet, View, Pressable, Alert, ScrollView, Platform } from 'react-native';
>>>>>>> REPLACE
```

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
  useEffect(() => {
    if (!permission) {
      requestPermission();
    }
  }, [permission, requestPermission]);

  if (!permission?.granted) {
=======
  useEffect(() => {
    if (!permission) {
      requestPermission();
    }
  }, [permission, requestPermission]);

  if (Platform.OS === 'web') {
    return (
      <ScrollView contentContainerStyle={styles.scroll} keyboardShouldPersistTaps="handled">
        <ThemedView style={styles.container}>
          <View style={[styles.preview, { backgroundColor: '#eee', alignItems: 'center', justifyContent: 'center' }]}>
            <ThemedText style={{ color: '#666' }}>Camera preview not available on web</ThemedText>
          </View>

          <View style={styles.actions}>
            <Pressable
              style={styles.captureButton}
              onPress={async () => {
                try {
                  setPhotoUri('web');
                  setResult(null);
                  const analysis = await analyzePhotoAsync('web');
                  setResult(analysis);
                  setNonnaResponse(buildNonnaResponse(analysis));
                } catch (e) {
                  Alert.alert('Mamma mia!', 'Nonna cannot analyze the photo. Try again.');
                }
              }}
            >
              <ThemedText style={styles.captureText}>Simulate Capture üîÆ</ThemedText>
            </Pressable>
          </View>

          <View style={styles.result}>
            {result ? (
              <>
                <ThemedText type="title">Superstition Result</ThemedText>
                <ThemedText style={styles.resultText}>
                  {result.icon} {result.title}
                </ThemedText>
                <ThemedText style={styles.resultSub}>{result.description}</ThemedText>
                <ThemedText style={styles.ritualTitle}>Ritual</ThemedText>
                <ThemedText style={styles.ritualText}>{result.ritual}</ThemedText>
                <ThemedText style={styles.nonnaTitle}>Nonna‚Äôs Verdict</ThemedText>
                <ThemedText style={styles.nonnaText}>{nonnaResponse}</ThemedText>
              </>
            ) : (
              <ThemedText style={styles.hint}>
                Click ‚ÄúSimulate Capture‚Äù and let Nonna divine the superstition. Madonna santissima! üì∑
              </ThemedText>
            )}
          </View>
        </ThemedView>
      </ScrollView>
    );
  }

  if (!permission?.granted) {
>>>>>>> REPLACE
```

app/(tabs)/superstition.tsx
```typescript
<<<<<<< SEARCH
          <Pressable style={styles.captureButton} onPress={onCapture}>
            <ThemedText style={styles.captureText}>Capture üîÆ</ThemedText>
          </Pressable>
=======
          <Pressable style={styles.captureButton} onPress={onCapture}>
            <ThemedText style={styles.captureText}>Take Photo üîÆ</ThemedText>
          </Pressable>
>>>>>>> REPLACE
```

> Tokens: 53k sent, 706 received. Cost: $0.07 message, $1.22 session.  
> Applied edit to app/(tabs)/superstition.tsx  
> Commit b5fd9fc feat: add web fallback and Take Photo button to superstition camera  
> You can use /undo to undo and discard each aider commit.  

#### aider app/\(tabs\)/index.tsx --message "Add much more variety to Nonna's responses - create at least 20 different response templates:  
#### 1. Add different response patterns based on question topics (love, food, work, family, money)  
#### 2. Create responses for different Nonna personalities (Sicilian, Roman, Neapolitan, Tuscan)  
#### 3. Add more Italian phrases, expressions, and cultural references  
#### 4. Include different levels of drama and emotion in responses  
#### 5. Make responses feel more personalized and less repetitive  
#### 6. Add seasonal or weather-related responses  
#### 7. Include references to Italian food, family traditions, and superstitions"  

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
import { generateWisdom, PERSONALITIES, Personality } from '@/lib/nonna';
 // Storage features temporarily disabled for basic functionality
=======
import { generateWisdom as baseGenerateWisdom, PERSONALITIES, Personality } from '@/lib/nonna';
 // Storage features temporarily disabled for basic functionality

// Rich variety response engine for Nonna
type Topic =
  | 'love'
  | 'food'
  | 'work'
  | 'family'
  | 'money'
  | 'health'
  | 'weather'
  | 'luck'
  | 'study'
  | 'travel'
  | 'home'
  | 'friendship'
  | 'fashion'
  | 'holiday'
  | 'default';

const EXCLAMAZIONI = [
  'Mamma mia!',
  'Madonna santissima!',
  'Aye bambino!',
  'Per l‚Äôamor di Dio!',
  'Uffa!',
  'Santo cielo!',
  'Ges√π, Giuseppe e Maria!',
];

const CLOSERS = [
  'Adesso mangia e respira, capito?',
  'No more nonsense ‚Äî Nonna knows best.',
  'Go, go ‚Äî do it subito, then call your mother.',
  'Say three Hail Marys and don‚Äôt argue with me.',
  'Now sit, eat, and listen to your elders.',
  'A biscotto solves many problems.',
];

const FOOD_BITS = [
  'Eat some lasagna and think with a full heart.',
  'Make a proper sauce ‚Äî low and slow ‚Äî wisdom comes with the aroma.',
  'A little espresso and a cornetto will give you courage.',
  'Some parmigiana and a nap, then decide.',
  'Pasta e fagioli never betrayed anyone.',
  'A bowl of minestrone when it‚Äôs cold, it heals the soul.',
];

const PERSONALITY_FLAIR: Record<Personality, string[]> = {
  'Sicilian Nonna': [
    'In Sicilia, we stare down problems like the sun stares at the sea.',
    'Don‚Äôt tempt the malocchio ‚Äî wear the cornicello and walk tall.',
    'The Sicilian wind brings omens; respect them and wear a scarf.',
  ],
  'Roman Nonna': [
    'In Roma, even the statues will judge you if you ignore wisdom.',
    'Take a passeggiata near something beautiful; your mind will follow.',
    'Remember, the Tiber flows slow ‚Äî so should your temper.',
  ],
  'Neapolitan Nonna': [
    'In Napoli we sing to our problems, then drown them in sauce.',
    'Mind the hands! Gesture with passion and cook with more.',
    'The Vesuvio sleeps but Nonna‚Äôs advice erupts ‚Äî listen!',
  ],
  'Tuscan Nonna': [
    'Pane, olio e calma ‚Äî simple ingredients, simple heart.',
    'If it doesn‚Äôt pair with ribollita, it‚Äôs not worth the stress.',
    'Walk the hills and breathe; the answer is in the olive trees.',
  ],
};

const TOPIC_TEMPLATES: Record<Topic, string[]> = {
  love: [
    'Matters of the heart are like al dente pasta ‚Äî firm but tender. If they don‚Äôt respect you, throw them back in the pot.',
    'Amore is like olive oil: if it‚Äôs good, it makes everything better; if it‚Äôs rancid, throw it out immediately.',
    'If they don‚Äôt text you back, marry the pasta. Pasta never leaves you.',
    'True love brings peace, not headaches. Headaches are from cheap wine, capito?',
  ],
  food: [
    'If the sauce is bland, so is the plan. More garlic, more patience.',
    'Don‚Äôt rush the soffritto; don‚Äôt rush your decisions.',
    'Salt the water like the sea, and season your life the same.',
    'Cook for someone and you‚Äôll know their soul by how they eat.',
  ],
  work: [
    'At work, keep your head high and your lunch homemade.',
    'A bad boss is like overcooked pasta ‚Äî you can‚Äôt fix it, you change the pot.',
    'Ask for what you deserve ‚Äî even the Pope asks for espresso.',
    'Do your job with pride; gossip is like burnt garlic, stinks up everything.',
  ],
  family: [
    'Family is like sauce ‚Äî sometimes it boils over, but it feeds everyone.',
    'Call your mother. If you don‚Äôt, I will come find you.',
    'Respect your elders or your sauce will never come out right.',
    'A Sunday lunch can fix a week of nonsense.',
  ],
  money: [
    'Money is like flour ‚Äî store it well, use it wisely.',
    'If you can‚Äôt afford it twice, you can‚Äôt afford it. Except for good olive oil.',
    'Save for a rainy day ‚Äî and for a proper coffee machine.',
    'Pay your debts like you salt your pasta ‚Äî on time and enough.',
  ],
  health: [
    'Wear a scarf ‚Äî I don‚Äôt care if it‚Äôs summer.',
    'Drink water, sleep well, and stop arguing with strangers on the internet.',
    'A walk after dinner, then you live to 100.',
    'Olive oil for the joints, laughter for the soul.',
  ],
  weather: [
    'If it rains, make polenta; if it shines, take a passeggiata.',
    'When the wind howls, close the windows and don‚Äôt anger the spirits.',
    'Snow? Perfect day for soup and cards with the family.',
    'Thunder means bake bread and tell stories.',
  ],
  luck: [
    'I sense the malocchio. Wear the cornicello and throw salt over your left shoulder.',
    'A black cat crossed your path? Pet a dog and you‚Äôre even.',
    'Spilled salt means you have clumsy hands ‚Äî fix it with a prayer and a biscotto.',
    'Touch iron, not wood ‚Äî Nonna said so.',
  ],
  study: [
    'Study like you‚Äôre making tiramisu ‚Äî careful, layered, with love.',
    'Write it by hand; the brain remembers what the hands respect.',
    'Take breaks; even sauce needs to rest.',
    'Bring snacks. Knowledge enters faster with biscotti.',
  ],
  travel: [
    'Travel light, like good focaccia ‚Äî simple and satisfying.',
    'If you‚Äôre lost, ask for directions and bring a smile.',
    'Never travel hungry ‚Äî bad decisions are made on an empty stomach.',
    'Take pictures, then put the phone away and live.',
  ],
  home: [
    'Sweep the floor outward ‚Äî keep the bad luck outside.',
    'Open the windows and let yesterday‚Äôs air leave.',
    'Plant basil on the balcony; good smells invite good days.',
    'Keep your table set for gratitude, not for dust.',
  ],
  friendship: [
    'A true friend brings soup. A fake friend brings drama.',
    'Break bread with those who break silence for you.',
    'If they mock your Nonna, release them like overcooked spaghetti.',
    'Choose friends who pass the sauce properly.',
  ],
  fashion: [
    'Dress with respect ‚Äî even the tomatoes are watching.',
    'Black is elegant, but a red scarf chases away gloom.',
    'Shoes comfortable, posture proud ‚Äî you are somebody‚Äôs treasure.',
    'Iron your shirt; wrinkles are for old men and bad sheets.',
  ],
  holiday: [
    'On Christmas, forgive and eat. On Easter, hope and eat. On Sunday, rest and eat.',
    'Make the good cookies and hide a few for yourself.',
    'Set another place at the table ‚Äî abundance invites abundance.',
    'Sing loudly so the neighbors know you‚Äôre alive.',
  ],
  default: [
    'Breathe. Then cook something simple ‚Äî answers rise like steam.',
    'Don‚Äôt argue with fools; argue with sauce, it listens.',
    'Light a candle, clean your room, and call your aunt.',
    'If the plan feels wrong, it probably is. Trust your stomach.',
  ],
};

const SEASONAL_SPICE = [
  'If it‚Äôs too hot, eat cold pasta salad and stop complaining.',
  'When it‚Äôs chilly, put on a sweater ‚Äî I don‚Äôt care about your ‚Äústyle.‚Äù',
  'If it rains today, invite someone for soup.',
  'Sunny days are for forgiveness and gelato.',
];

function pick<T>(arr: T[]): T {
  return arr[Math.floor(Math.random() * arr.length)];
}

function categorizeTopic(q: string): Topic {
  const s = q.toLowerCase();
  const has = (words: string[]) => words.some((w) => s.includes(w));
  if (has(['love', 'heart', 'crush', 'date', 'marry', 'relationship'])) return 'love';
  if (has(['food', 'cook', 'pasta', 'sauce', 'recipe', 'eat', 'kitchen'])) return 'food';
  if (has(['work', 'job', 'boss', 'career', 'office', 'promotion'])) return 'work';
  if (has(['family', 'mother', 'father', 'nonna', 'nonno', 'kids', 'children', 'sibling'])) return 'family';
  if (has(['money', 'rent', 'debt', 'bills', 'salary', 'pay'])) return 'money';
  if (has(['sick', 'health', 'doctor', 'cold', 'exercise', 'diet'])) return 'health';
  if (has(['weather', 'rain', 'snow', 'sun', 'wind', 'storm'])) return 'weather';
  if (has(['luck', 'superstition', 'malocchio', 'evil eye', 'black cat', 'salt'])) return 'luck';
  if (has(['study', 'school', 'exam', 'homework', 'university'])) return 'study';
  if (has(['travel', 'trip', 'flight', 'train', 'vacation'])) return 'travel';
  if (has(['home', 'house', 'apartment', 'room', 'clean'])) return 'home';
  if (has(['friend', 'friendship', 'bestie', 'buddy'])) return 'friendship';
  if (has(['fashion', 'clothes', 'dress', 'wear', 'outfit'])) return 'fashion';
  if (has(['christmas', 'easter', 'holiday', 'sunday'])) return 'holiday';
  return 'default';
}

function cap(s: string) {
  return s.charAt(0).toUpperCase() + s.slice(1);
}

function generateRichWisdom(question: string, personality: Personality): string {
  const topic = categorizeTopic(question);
  const ex = pick(EXCLAMAZIONI);
  const flair = pick(PERSONALITY_FLAIR[personality]);
  const core = pick(TOPIC_TEMPLATES[topic]);
  const food = pick(FOOD_BITS);
  const seasonal = pick(SEASONAL_SPICE);
  const closer = pick(CLOSERS);

  // At least 20+ templates are spread across topics. Final string stitches multiple layers.
  return [
    `${ex} ${cap(personality)} has heard your question: ‚Äú${question}‚Äù`,
    flair,
    core,
    seasonal,
    food,
    closer,
  ].join(' ');
}
>>>>>>> REPLACE
```

app/(tabs)/index.tsx
```typescript
<<<<<<< SEARCH
      const advice = generateWisdom(question.trim(), personality);
      setResponse(advice);
=======
      const advice =
        generateRichWisdom(question.trim(), personality) ||
        baseGenerateWisdom(question.trim(), personality);
      setResponse(advice);
>>>>>>> REPLACE
```

> Tokens: 55k sent, 2.5k received. Cost: $0.09 message, $1.31 session.  
> Applied edit to app/(tabs)/index.tsx  
> Commit 8a71881 feat: add rich, multi-topic Nonna response engine with personalities  
> You can use /undo to undo and discard each aider commit.  
